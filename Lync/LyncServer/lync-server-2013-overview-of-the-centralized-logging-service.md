---
title: 'Lync Server 2013: Panoramica del servizio di registrazione centralizzato'
description: 'Lync Server 2013: Panoramica del servizio di registrazione centralizzato.'
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
f1.keywords:
- NOCSH
TOCTitle: Overview of the Centralized Logging Service
ms:assetid: 975718a0-f3e3-404d-9453-6224e73bfdd0
ms:mtpsurl: https://technet.microsoft.com/en-us/library/JJ688145(v=OCS.15)
ms:contentKeyID: 49733746
ms.date: 07/23/2014
manager: serdars
mtps_version: v=OCS.15
ms.openlocfilehash: a357063ff80611789981f5e98a69899ea5cd27a9
ms.sourcegitcommit: d42a21b194f4a45e828188e04b25c1ce28a5d1ae
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/17/2020
ms.locfileid: "48560912"
---
# <a name="overview-of-the-centralized-logging-service-in-lync-server-2013"></a><span data-ttu-id="9197b-103">Panoramica del servizio di registrazione centralizzato in Lync Server 2013</span><span class="sxs-lookup"><span data-stu-id="9197b-103">Overview of the Centralized Logging Service in Lync Server 2013</span></span>

<div data-xmlns="http://www.w3.org/1999/xhtml">

<div class="topic" data-xmlns="http://www.w3.org/1999/xhtml" data-msxsl="urn:schemas-microsoft-com:xslt" data-cs="https://msdn.microsoft.com/">

<div data-asp="https://msdn2.microsoft.com/asp">



</div>

<div id="mainSection">

<div id="mainBody">

<span> </span>

<span data-ttu-id="9197b-104">_**Ultimo argomento modificato:** 2013-02-22_</span><span class="sxs-lookup"><span data-stu-id="9197b-104">_**Topic Last Modified:** 2013-02-22_</span></span>

<span data-ttu-id="9197b-105">Il servizio di registrazione centralizzato è stato creato per fornire un mezzo per la raccolta controllata di dati, con un ambito esteso o stretto.</span><span class="sxs-lookup"><span data-stu-id="9197b-105">The Centralized Logging Service is designed to provide a means for controlled collection of data—with a broad or narrow scope.</span></span> <span data-ttu-id="9197b-106">È possibile raccogliere dati da tutti i server della distribuzione contemporaneamente, definire specifici elementi di cui tenere traccia, impostare flag di traccia e restituire risultati della ricerca da un singolo computer o un'aggregazione di tutti i dati di tutti i server.</span><span class="sxs-lookup"><span data-stu-id="9197b-106">You can collect data from all servers in the deployment concurrently, define specific elements to trace, set trace flags and return search results from a single computer or an aggregation of all data from all servers.</span></span> <span data-ttu-id="9197b-107">Il servizio di registrazione centralizzato viene eseguito in tutti i server della distribuzione.</span><span class="sxs-lookup"><span data-stu-id="9197b-107">The Centralized Logging Service runs on all servers in your deployment.</span></span> <span data-ttu-id="9197b-108">L'architettura del servizio di registrazione centralizzato è costituita dai seguenti agenti e servizi:</span><span class="sxs-lookup"><span data-stu-id="9197b-108">The architecture of the Centralized Logging Service is comprised of the following agents and services:</span></span>

  - <span data-ttu-id="9197b-109">Agente di servizio di *registrazione centralizzato*    ClsAgent.exe è il file eseguibile del servizio che comunica con il controller e riceve i comandi emessi dal controller dall'amministratore.</span><span class="sxs-lookup"><span data-stu-id="9197b-109">*Centralized Logging Service Agent*   ClsAgent.exe is the service executable that communicates with the controller and receives the commands that the controller is issued by the administrator.</span></span> <span data-ttu-id="9197b-110">L'agente viene eseguito come servizio in ogni computer Lync Server.</span><span class="sxs-lookup"><span data-stu-id="9197b-110">The agent is run as a service on each Lync Server computer.</span></span> <span data-ttu-id="9197b-111">Quando l'agente riceve un comando, lo esegue, invia messaggi ai componenti definiti per la traccia e scrive i log di traccia su disco.</span><span class="sxs-lookup"><span data-stu-id="9197b-111">When the agent receives a command, it executes the command, sends messages to the defined components for tracing, and writes the trace logs to disk.</span></span> <span data-ttu-id="9197b-112">Legge inoltre i log di traccia per il computer e reinvia i dati di traccia al controller quando richiesto.</span><span class="sxs-lookup"><span data-stu-id="9197b-112">It also reads the trace logs for its computer and sends the trace data back to the controller when requested.</span></span> <span data-ttu-id="9197b-113">ClsAgent è in attesa dei comandi sulle porte seguenti: **TCP 50001**, **TCP 50002** e **TCP 50003**.</span><span class="sxs-lookup"><span data-stu-id="9197b-113">The ClsAgent listens for commands on the following ports: **TCP 50001**, **TCP 50002**, and **TCP 50003**.</span></span>

  - <span data-ttu-id="9197b-114">Controller del servizio di *registrazione centralizzato*    ClsControllerLib.dll è il motore di esecuzione dei comandi per Lync Server Management Shell e per ClsController.exe.</span><span class="sxs-lookup"><span data-stu-id="9197b-114">*Centralized Logging Service Controller*   ClsControllerLib.dll is the command execution engine for the Lync Server Management Shell and for ClsController.exe.</span></span> <span data-ttu-id="9197b-115">CLSControllerLib.dll invia comandi Start, stop, Flush e Search al ClsAgent.</span><span class="sxs-lookup"><span data-stu-id="9197b-115">CLSControllerLib.dll sends Start, Stop, Flush, and Search commands to the ClsAgent.</span></span> <span data-ttu-id="9197b-116">Quando vengono inviati i comandi di ricerca, i registri risultanti vengono restituiti alla ClsControllerLib.dll e aggregati.</span><span class="sxs-lookup"><span data-stu-id="9197b-116">When search commands are sent, the resulting logs are returned to the ClsControllerLib.dll and aggregated.</span></span> <span data-ttu-id="9197b-117">Il controller è responsabile dell'invio di comandi all'agente, del ricevimento dello stato di tali comandi e della gestione dei dati dei file di registro di ricerca come restituiti da tutti gli agenti di qualsiasi computer nell'ambito di ricerca e dell'aggregazione dei dati del log in un set di output significativo e ordinato.</span><span class="sxs-lookup"><span data-stu-id="9197b-117">The controller is responsible for sending commands to the agent, receiving the status of those commands and managing the search log file data as it is returned from all agents on any computer in the search scope, and aggregating the log data into a meaningful and ordered output set.</span></span> <span data-ttu-id="9197b-118">Le informazioni contenute negli argomenti seguenti sono incentrate sull'utilizzo di Lync Server Management Shell.</span><span class="sxs-lookup"><span data-stu-id="9197b-118">The information in the following topics is focused on using the Lync Server Management Shell.</span></span> <span data-ttu-id="9197b-119">ClsController.exe è limitato a un sottoinsieme delle funzionalità e delle funzioni disponibili in Lync Server Management Shell.</span><span class="sxs-lookup"><span data-stu-id="9197b-119">ClsController.exe is limited to a subset of the features and functions that are available in the Lync Server Management Shell.</span></span> <span data-ttu-id="9197b-120">La guida per ClsController.exe è disponibile dalla riga di comando digitando `ClsController` la directory predefinita C: \\ Program Files \\ Common Files \\ Microsoft Lync Server 2013 \\ ClsAgent.</span><span class="sxs-lookup"><span data-stu-id="9197b-120">Help for ClsController.exe is available at the command line by typing `ClsController` in the default directory C:\\Program Files\\Common Files\\Microsoft Lync Server 2013\\ClsAgent.</span></span>

<span data-ttu-id="9197b-121">**Comunicazioni di ClsController a ClsAgent**</span><span class="sxs-lookup"><span data-stu-id="9197b-121">**ClsController communications to ClsAgent**</span></span>

<span data-ttu-id="9197b-122">![Relazione tra CLSController e CLSAgent.](images/JJ688145.68c90811-5cf9-4a84-95b7-ea9ffc61eac4(OCS.15).jpg "Relazione tra CLSController e CLSAgent.")</span><span class="sxs-lookup"><span data-stu-id="9197b-122">![Relationship between CLSController and CLSAgent.](images/JJ688145.68c90811-5cf9-4a84-95b7-ea9ffc61eac4(OCS.15).jpg "Relationship between CLSController and CLSAgent.")</span></span>

<span data-ttu-id="9197b-123">È possibile emettere comandi utilizzando l'interfaccia della riga di comando di Windows Server o l'utilizzo di Lync Server Management Shell.</span><span class="sxs-lookup"><span data-stu-id="9197b-123">You issue commands using the Windows Server command-line interface or using the Lync Server Management Shell.</span></span> <span data-ttu-id="9197b-124">I comandi vengono eseguiti nel computer a cui è connesso l'utente e inviati al ClsAgent locale o agli altri computer e pool della distribuzione.</span><span class="sxs-lookup"><span data-stu-id="9197b-124">The commands are executed on the computer you are logged in to and sent to the ClsAgent locally or to the other computers and pools in your deployment.</span></span>

<span data-ttu-id="9197b-125">ClsAgent mantiene un file di indice di tutti i file CACHE che si trova nel computer locale.</span><span class="sxs-lookup"><span data-stu-id="9197b-125">ClsAgent maintains an index file of all .CACHE files that it has on the local machine.</span></span> <span data-ttu-id="9197b-126">ClsAgent li alloca in modo che vengano distribuiti uniformemente tra i volumi definiti mediante l'opzione CacheFileLocalFolders, senza mai occupare più dell'80% di ogni volume (ovvero il percorso della cache locale e la percentuale sono configurabili mediante il cmdlet **Set-CsClsConfiguration**).</span><span class="sxs-lookup"><span data-stu-id="9197b-126">ClsAgent allocates them so that they are evenly distributed across volumes defined by the option CacheFileLocalFolders, never consuming more than 80% of each volume (that is, the local cache location and the percentage is configurable using the **Set-CsClsConfiguration** cmdlet).</span></span> <span data-ttu-id="9197b-127">ClsAgent è anche responsabile dei file di traccia degli eventi (etl) in scadenza memorizzati nella cache del computer locale.</span><span class="sxs-lookup"><span data-stu-id="9197b-127">ClsAgent is also responsible for aging old cached event trace log (.etl) files off the local machine.</span></span> <span data-ttu-id="9197b-128">Dopo due settimane (il periodo di tempo è configurabile mediante il cmdlet **Set-CsClsConfiguration**) questi file vengono copiati in una condivisione ed eliminati dal computer locale.</span><span class="sxs-lookup"><span data-stu-id="9197b-128">After two weeks (that is, the timeframe is configurable using the **Set-CsClsConfiguration** cmdlet) these files are copied to a file share and deleted from the local computer.</span></span> <span data-ttu-id="9197b-129">Per dettagli, vedere [Set-CsClsConfiguration](https://docs.microsoft.com/powershell/module/skype/Set-CsClsConfiguration).</span><span class="sxs-lookup"><span data-stu-id="9197b-129">For details, see [Set-CsClsConfiguration](https://docs.microsoft.com/powershell/module/skype/Set-CsClsConfiguration).</span></span> <span data-ttu-id="9197b-130">Quando si riceve una richiesta di ricerca, i criteri di quest'ultima vengono usati per selezionare il set di file etl memorizzati nella cache per eseguire la ricerca in base ai valori nell'indice mantenuto dall'agente.</span><span class="sxs-lookup"><span data-stu-id="9197b-130">When a search request is received, the search criteria is used to select the set of cached .etl files to perform the search based on the values in the index maintained by the agent.</span></span>

<div>


> [!NOTE]  
> <span data-ttu-id="9197b-p106">I file che vengono spostati nella condivisione di file dal computer locale possono essere ricercati da ClsAgent. Dopo che ClsAgent sposta i file nella condivisione, la scadenza e la rimozione dei file non vengono gestite da ClsAgent. È necessario definire un'attività amministrativa per monitorare le dimensioni dei file nella condivisione ed eliminarli o archiviarli.</span><span class="sxs-lookup"><span data-stu-id="9197b-p106">Files that are moved to the file share from the local computer can be searched by ClsAgent. Once ClsAgent moves the files to the file share, the aging and removal of files is not maintained by ClsAgent. You should define an administrative task to monitor the size of the files in the file share and delete them or archive them.</span></span>



</div>

<span data-ttu-id="9197b-134">I file di log risultanti possono essere letti e analizzati mediante diversi strumenti, tra cui **Snooper.exe** e qualsiasi strumento in grado di leggere file di testo, come **Notepad.exe**.</span><span class="sxs-lookup"><span data-stu-id="9197b-134">The resulting log files can be read and analyzed using a variety of tools, including **Snooper.exe** and any tool that can read a text file, such as **Notepad.exe**.</span></span> <span data-ttu-id="9197b-135">Snooper.exe fa parte degli strumenti di debug di Lync Server 2013 ed è disponibile come download Web [https://go.microsoft.com/fwlink/?LinkId=285257](https://go.microsoft.com/fwlink/?linkid=285257) .</span><span class="sxs-lookup"><span data-stu-id="9197b-135">Snooper.exe is part of the Lync Server 2013 Debug Tools and is available as a Web download from [https://go.microsoft.com/fwlink/?LinkId=285257](https://go.microsoft.com/fwlink/?linkid=285257).</span></span>

<span data-ttu-id="9197b-136">Come OCSLogger, il servizio di registrazione centralizzato dispone di diversi componenti su cui eseguire la traccia e fornisce le opzioni per selezionare i flag, ad esempio TF \_ Component e TF \_ diag.</span><span class="sxs-lookup"><span data-stu-id="9197b-136">Like OCSLogger, the Centralized Logging Service has several components to trace against, and provides options to select flags, such as TF\_COMPONENT and TF\_DIAG.</span></span> <span data-ttu-id="9197b-137">Il servizio di registrazione centralizzato conserva anche le opzioni del livello di registrazione di OCSLogger.</span><span class="sxs-lookup"><span data-stu-id="9197b-137">Centralized Logging Service also retains the logging level options of OCSLogger.</span></span>

<span data-ttu-id="9197b-138">Il vantaggio più importante per l'utilizzo di Lync Server Management Shell tramite l'ClsController della riga di comando è che è possibile configurare e definire nuovi scenari utilizzando provider selezionati che si riferiscono allo spazio dei problemi, ai flag personalizzati e ai livelli di registrazione.</span><span class="sxs-lookup"><span data-stu-id="9197b-138">The most important advantage to using the Lync Server Management Shell over the command-line ClsController is that you can configure and define new scenarios using selected providers that target the problem space, custom flags, and logging levels.</span></span> <span data-ttu-id="9197b-139">Gli scenari disponibili in ClsController sono limitati a quelli definiti per l'eseguibile.</span><span class="sxs-lookup"><span data-stu-id="9197b-139">The scenarios available to ClsController are limited to those that are defined for the executable.</span></span>

<span data-ttu-id="9197b-p110">Nelle versioni precedenti, OCSLogger.exe consente agli amministratori e al personale di supporto di raccogliere file di traccia dai computer nella distribuzione. OCSLogger, nonostante tutti i punti di forza, ha una lacuna. È possibile collegare i log a un solo computer alla volta. È possibile accedere a più computer usando copie separate di OCSLogger, tuttavia ciò produce più log e nessun modo semplice per aggregare i risultati.</span><span class="sxs-lookup"><span data-stu-id="9197b-p110">In previous versions, OCSLogger.exe was provided to enable administrators and support personnel to collect trace files from computers in the deployment. OCSLogger, for all of its strengths, had a shortcoming. You could only collect logs on one computer at a given time. You could log on to multiple computers by using separate copies of OCSLogger, but you ended up with multiple logs and no easy way to aggregate the results.</span></span>

<span data-ttu-id="9197b-p111">Quando un utente richiede una ricerca di log, ClsController determina i computer a cui inviare la richiesta (in base agli scenari selezionati). Determina anche se la ricerca deve essere inviata alla condivisione di file in cui sono stati salvati i file con estensione etl. Quando i risultati di riceva vengono restituiti a ClsController, il controller li unisce in un singolo set di risultati in ordine cronologico presentato all'utente. Gli utenti possono salvare i risultati di ricerca nel proprio computer locale per ulteriori analisi.</span><span class="sxs-lookup"><span data-stu-id="9197b-p111">When a user requests a log search, the ClsController determines which machines to send the request to (that is, based on the scenarios selected). It also determines whether the search needs to be sent to the file share where the saved .etl files are located. When the search results are returned to the ClsController, the controller merges the results into a single time-ordered result set that is presented to the user. Users can save the search results to their local machine for further analysis.</span></span>

<span data-ttu-id="9197b-p112">Quando si avvia una sessione di registrazione, si specificano scenari relativi al problema da risolvere. È possibile eseguire due scenari alla volta. Uno di questi scenari deve essere quello AlwaysOn, ovvero deve essere sempre in esecuzione nella distribuzione per raccogliere informazioni su tutti i computer, i pool e i componenti.</span><span class="sxs-lookup"><span data-stu-id="9197b-p112">When you start a logging session, you specify scenarios that are relative to the problem that you are trying to resolve. You can have two scenarios running at any time. One of these two scenarios should be the AlwaysOn scenario. As the name implies, it should always be running in your deployment, collecting information on all computers, pools, and components.</span></span>

<div>


> [!IMPORTANT]  
> <span data-ttu-id="9197b-152">Per impostazione predefinita, lo scenario AlwaysOn non è in esecuzione nella distribuzione.</span><span class="sxs-lookup"><span data-stu-id="9197b-152">By default, the AlwaysOn scenario is not running in your deployment.</span></span> <span data-ttu-id="9197b-153">È necessario avviarlo in modo esplicito.</span><span class="sxs-lookup"><span data-stu-id="9197b-153">You must explicitly start the scenario.</span></span> <span data-ttu-id="9197b-154">Una volta avviato, il servizio continua a essere eseguito fino all'arresto esplicito e lo stato di esecuzione permane nonostante i riavvii del computer.</span><span class="sxs-lookup"><span data-stu-id="9197b-154">Once started, it will continue to run until explicitly stopped, and the running state will persist through reboots of the computers.</span></span> <span data-ttu-id="9197b-155">Per informazioni dettagliate sull'avvio e l'interruzione degli scenari, vedere <A href="lync-server-2013-using-start-for-the-centralized-logging-service-to-capture-logs.md">using Start for the accentrated Logging Service to capture logs in Lync server 2013</A> e <A href="lync-server-2013-using-stop-for-the-centralized-logging-service.md">using stop for the accentrated Logging Service in Lync Server 2013</A>.</span><span class="sxs-lookup"><span data-stu-id="9197b-155">For details on starting and stopping scenarios, see <A href="lync-server-2013-using-start-for-the-centralized-logging-service-to-capture-logs.md">Using Start for the Centralized Logging Service to capture logs in Lync Server 2013</A> and <A href="lync-server-2013-using-stop-for-the-centralized-logging-service.md">Using Stop for the Centralized Logging Service in Lync Server 2013</A>.</span></span>



</div>

<span data-ttu-id="9197b-p114">Quando si verifica un problema, avviare un secondo scenario correlato al problema segnalato. Riprodurre il problema e arrestare la registrazione per il secondo scenario. Iniziare le ricerche dei log relativi al problema segnalato. La raccolta aggregata dei log produce un file di log contenente i messaggi di traccia di tutti i computer nel sito oppure dell'ambito globale della distribuzione. Se la ricerca restituisce più dati di quanti sia possibile analizzarne (condizione nota in genere come rapporto segnale/rumore, in cui il rumore è troppo elevato), è possibile eseguire un'altra ricerca con parametri più limitati. A questo punto, è possibile iniziare a osservare i modelli risultati in modo da formarsi un quadro più chiaro del problema. Infine, dopo aver eseguito un paio di ricerche perfezionate, è possibile individuare i dati rilevanti per il problema e dedurne la causa principale.</span><span class="sxs-lookup"><span data-stu-id="9197b-p114">When a problem occurs, start a second scenario that relates to the problem reported. Reproduce the problem, and stop the logging for the second scenario. Begin your log searches relative to the problem reported. The aggregated collection of logs produces a log file that contains trace messages from all computers in your site or global scope of your deployment. If the search returns more data than you can feasibly analyze (typically known as a signal-to-noise ratio, where the noise is too high), you run another search with narrower parameters. At this point, you can begin to notice patterns that show up and can help you get a clearer focus on the problem. Ultimately, after you perform a couple of refined searches you can find data that is relevant to the problem and figure out the root cause.</span></span>

<div>


> [!TIP]  
> <span data-ttu-id="9197b-163">Quando viene presentato un problema in Lync Server, iniziare a chiedersi "che cosa è già noto sul problema?"</span><span class="sxs-lookup"><span data-stu-id="9197b-163">When presented with a problem scenario in Lync Server, start by asking yourself “What do I already know about the problem?”</span></span> <span data-ttu-id="9197b-164">Se si quantificano i limiti del problema, è possibile eliminare una parte importante delle entità operative in Lync Server.</span><span class="sxs-lookup"><span data-stu-id="9197b-164">If you quantify the problem boundaries, you can eliminate a large part of the operational entities in Lync Server.</span></span><BR><span data-ttu-id="9197b-165">Considerare ad esempio uno scenario in cui si sa che gli utenti non ricevono risultati aggiornati quando cercano un contatto.</span><span class="sxs-lookup"><span data-stu-id="9197b-165">Consider an example scenario where you know that users are not getting current results when looking for a contact.</span></span> <span data-ttu-id="9197b-166">Non vi è alcun motivo per cercare problemi nei componenti multimediali, VoIP aziendale, conferenze e un certo numero di altri componenti.</span><span class="sxs-lookup"><span data-stu-id="9197b-166">There is no point in looking for problems in the media components, Enterprise Voice, conferencing, and a number of other components.</span></span> <span data-ttu-id="9197b-167">Ciò che potrebbe non essere noto è la posizione effettiva da cui trae origine il problema: lato client o lato server?</span><span class="sxs-lookup"><span data-stu-id="9197b-167">What you may not know is where the problem actually is: on the client, or is this a server-side problem?</span></span> <span data-ttu-id="9197b-168">I contatti vengono raccolti da Active Directory da User Replicator e recapitati al client tramite il server della Rubrica (ABServer).</span><span class="sxs-lookup"><span data-stu-id="9197b-168">Contacts are collected from Active Directory by the User Replicator and delivered to the client by way of the Address Book Server (ABServer).</span></span> <span data-ttu-id="9197b-169">ABServer ottiene gli aggiornamenti dal database RTC (dopo i dati sono stati scritti da User Replicator) e li raccoglie in file della rubrica per impostazione predefinita alle 1.30.</span><span class="sxs-lookup"><span data-stu-id="9197b-169">The ABServer gets its updates from the RTC database (where User Replicator wrote them) and collects them into address book files, by default – 1:30 AM.</span></span> <span data-ttu-id="9197b-170">I client di Lync Server recuperano la nuova rubrica in base a una pianificazione casuale.</span><span class="sxs-lookup"><span data-stu-id="9197b-170">The Lync Server clients retrieve the new address book on a randomized schedule.</span></span> <span data-ttu-id="9197b-171">Poiché si sa come funziona il processo, è possibile ridurre la ricerca per la causa potenziale di un problema relativo ai dati raccolti da Active Directory da User Replicator, che il ABServer non è in grado di recuperare e creare i file della rubrica oppure che i client non possono scaricare il file della Rubrica.</span><span class="sxs-lookup"><span data-stu-id="9197b-171">Because you know how the process works, you can reduce your search for the potential cause to an issue related to data being collected from Active Directory by the User Replicator, the ABServer not retrieving and creating the address book files, or the clients not downloading the address book file.</span></span>



</div>

</div>

<span> </span>

</div>

</div>

</div>

