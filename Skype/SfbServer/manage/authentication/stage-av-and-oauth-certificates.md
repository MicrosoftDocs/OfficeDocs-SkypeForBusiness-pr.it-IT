---
title: Passaggio dei certificati AV e OAuth in Skype for Business Server con -Roll in Set-CsCertificate
ms.reviewer: ''
ms.author: v-cichur
author: cichur
manager: serdars
audience: ITPro
ms.topic: article
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
localization_priority: Normal
ms.collection: IT_Skype16
ms.assetid: 22dec3cc-4b6b-4df2-b269-5b35df4731a7
description: 'Riepilogo: passaggio dei certificati AV e OAuth per Skype for Business Server.'
ms.openlocfilehash: a2586e9ebda1bae1605fd6033681b469e6731b8c
ms.sourcegitcommit: c528fad9db719f3fa96dc3fa99332a349cd9d317
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/12/2021
ms.locfileid: "49806556"
---
# <a name="stage-av-and-oauth-certificates-in-skype-for-business-server-using--roll-in-set-cscertificate"></a><span data-ttu-id="bd9e5-103">Passaggio dei certificati AV e OAuth in Skype for Business Server con -Roll in Set-CsCertificate</span><span class="sxs-lookup"><span data-stu-id="bd9e5-103">Stage AV and OAuth certificates in Skype for Business Server using -Roll in Set-CsCertificate</span></span>
 
<span data-ttu-id="bd9e5-104">**Riepilogo:** Passaggio dei certificati AV e OAuth per Skype for Business Server.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-104">**Summary:** Stage AV and OAuth certificates for Skype for Business Server.</span></span>
  
<span data-ttu-id="bd9e5-105">Le comunicazioni audio/video (A/V) sono un componente chiave di Skype for Business Server.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-105">Audio/Video (A/V) communications is a key component of Skype for Business Server.</span></span> <span data-ttu-id="bd9e5-106">Funzionalità quali la condivisione di applicazioni e le conferenze audio e video si basano sui certificati assegnati al servizio A/V Edge, in particolare il servizio di autenticazione A/V.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-106">Features such as application sharing and audio and video conferencing rely on the certificates assigned to the A/V Edge service, specifically the A/V Authentication service.</span></span>
  
> [!IMPORTANT]
> <span data-ttu-id="bd9e5-107">Questa nuova funzionalità è progettata per funzionare per il servizio A/V Edge e il certificato OAuthTokenIssuer.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-107">This new feature is designed to work for the A/V Edge service and the OAuthTokenIssuer certificate.</span></span> <span data-ttu-id="bd9e5-108">È possibile eseguire il provisioning di altri tipi di certificato insieme al servizio A/V Edge e al tipo di certificato OAuth, ma non trarranno vantaggio dal comportamento di coesistenza del certificato del servizio A/V Edge.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-108">Other certificate types can be provisioned along with the A/V Edge service and OAuth certificate type, but will not benefit from the coexistence behavior that the A/V Edge service certificate will.</span></span>
  
<span data-ttu-id="bd9e5-109">I cmdlet di PowerShell di Skype for Business Server Management Shell utilizzati per gestire i certificati di Skype for Business Server si riferiscono al certificato del servizio A/V Edge come tipo di certificato AudioVideoAuthentication e al certificato OAuthServer come typeOAuthTokenIssuer.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-109">The Skype for Business Server Management Shell PowerShell cmdlets used to manage Skype for Business Server certificates refers to the A/V Edge service certificate as the AudioVideoAuthentication certificate type and the OAuthServer certificate as typeOAuthTokenIssuer.</span></span> <span data-ttu-id="bd9e5-110">Per il resto di questo argomento e per identificare in modo univoco i certificati, verranno indicati dallo stesso tipo di identificatore, AudioVideoAuthentication eOAuthTokenIssuer.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-110">For the rest of this topic and to uniquely identify the certificates, they will be referred to by the same identifier type, AudioVideoAuthentication andOAuthTokenIssuer.</span></span>
  
<span data-ttu-id="bd9e5-111">Il servizio di autenticazione A/V è responsabile dell'emissione di token utilizzati dai client e da altri consumer A/V.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-111">The A/V Authentication service is responsible for issuing tokens that are used by clients and other A/V consumers.</span></span> <span data-ttu-id="bd9e5-112">I token vengono generati dagli attributi del certificato e alla scadenza del certificato, si verifica la perdita di connessione e il requisito di ricongiungersi a un nuovo token generato dal nuovo certificato.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-112">The tokens are generated from attributes on the certificate, and when the certificate expires, loss of connection and requirement to rejoin with a new token generated by the new certificate will result.</span></span> <span data-ttu-id="bd9e5-113">Una nuova funzionalità di Skype for Business Server allevierà questo problema: la possibilità di impostare un nuovo certificato prima della scadenza del vecchio e consentire a entrambi i certificati di continuare a funzionare per un periodo di tempo.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-113">A new feature in Skype for Business Server will alleviate this problem - the ability to stage a new certificate in advance of the old one expiring and allowing both certificates to continue to function for a period of time.</span></span> <span data-ttu-id="bd9e5-114">Questa funzionalità utilizza funzionalità aggiornate nel cmdlet Set-CsCertificate Skype for Business Server Management Shell.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-114">This feature uses updated functionality in the Set-CsCertificate Skype for Business Server Management Shell cmdlet.</span></span> <span data-ttu-id="bd9e5-115">Il nuovo parametro -Roll, con il parametro esistente -EffectiveDate, insererà il nuovo certificato AudioVideoAuthentication nell'archivio certificati.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-115">The new parameter -Roll, with the existing parameter -EffectiveDate, will place the new AudioVideoAuthentication certificate in the certificate store.</span></span> <span data-ttu-id="bd9e5-116">Il certificato AudioVideoAuthentication precedente continuerà a rimanere per i token emessi da convalidare.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-116">The older AudioVideoAuthentication certificate will still remain for issued tokens to be validated against.</span></span> <span data-ttu-id="bd9e5-117">A partire dall'inserimento del nuovo certificato AudioVideoAuthentication, si verificherà la seguente serie di eventi:</span><span class="sxs-lookup"><span data-stu-id="bd9e5-117">Beginning with putting the new AudioVideoAuthentication certificate in place, the following series of events will occur:</span></span>
  
> [!TIP]
> <span data-ttu-id="bd9e5-118">Utilizzando i cmdlet di Skype for Business Server Management Shell per la gestione dei certificati, è possibile richiedere certificati separati e distinti per ogni scopo nel server perimetrale.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-118">Using the Skype for Business Server Management Shell cmdlets for managing certificates, you can request separate and distinct certificates for each purpose on the Edge Server.</span></span> <span data-ttu-id="bd9e5-119">L'uso della Configurazione guidata certificati nella Distribuzione guidata di Skype for  Business Server consente di creare certificati, ma in genere è del tipo predefinito che usa tutti i certificati per il server perimetrale in un singolo certificato.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-119">Using the Certificate Wizard in the Skype for Business Server Deployment Wizard assists you in creating certificates, but is typically of the **default** type which couples all certificate uses for the Edge Server onto a single certificate.</span></span> <span data-ttu-id="bd9e5-120">Se si intende utilizzare la funzionalità di certificati in sequenza, la procedura consigliata consiste nel disassociare il certificato AudioVideoAuthentication dagli scopi degli altri certificati.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-120">The recommended practice if you are going to use the rolling certificate feature is to decouple the AudioVideoAuthentication certificate from the other certificate purposes.</span></span> <span data-ttu-id="bd9e5-121">È possibile effettuare il provisioning e gestire temporaneamente un certificato di tipo predefinito, ma solo la parte AudioVideoAuthentication del certificato combinato sfrutterà i vantaggi della gestione temporanea.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-121">You can provision and stage a certificate of the Default type, but only the AudioVideoAuthentication portion of the combined certificate will benefit from the staging.</span></span> <span data-ttu-id="bd9e5-122">Un utente coinvolto in una conversazione di messaggistica istantanea alla scadenza del certificato dovrà disconnettersi ed eseguire di nuovo l'accesso per utilizzare il nuovo certificato associato al servizio Access Edge.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-122">A user involved in (for example) an instant messaging conversation when the certificate expires will need to log out and log back in to make use of the new certificate associated with the Access Edge service.</span></span> <span data-ttu-id="bd9e5-123">Si verificherà un comportamento simile per un utente coinvolto in una conferenza Web tramite il servizio Web Conferencing Edge.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-123">Similar behavior will occur for a user involved in a Web conference using the Web Conferencing Edge service.</span></span> <span data-ttu-id="bd9e5-124">Il certificato OAuthTokenIssuer è un tipo specifico condiviso in tutti i server.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-124">The OAuthTokenIssuer certificate is a specific type that is shared across all servers.</span></span> <span data-ttu-id="bd9e5-125">È possibile creare e gestire il certificato in un'unica posizione e il certificato viene archiviato nell'archivio di gestione centrale per tutti gli altri server.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-125">You create and manage the certificate in one place and the certificate is stored in the Central Management store for all other servers.</span></span>
  
<span data-ttu-id="bd9e5-126">Per comprendere appieno le opzioni e i requisiti relativi all'uso del cmdlet Set-CsCertificate e alla gestione temporanea di certificati tramite tale cmdlet prima della scadenza del certificato corrente, sono necessarie altre informazioni.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-126">Additional detail is needed to fully understand your options and requirements when using the Set-CsCertificate cmdlet and using it to stage certificates prior to the current certificate expiring.</span></span> <span data-ttu-id="bd9e5-127">Il parametro -Roll è importante, ma essenzialmente un unico scopo.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-127">The -Roll parameter is important, but essentially single purpose.</span></span> <span data-ttu-id="bd9e5-128">Se lo si definisce come parametro, si indica a Set-CsCertificate che verranno fornite informazioni sul certificato che sarà interessato da -Type (ad esempio AudioVideoAuthentication e OAuthTokenIssuer), quando il certificato diventerà effettivo definito da -EffectiveDate.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-128">If you define it as a parameter, you are telling Set-CsCertificate that you will be providing information about the certificate that will be affected defined by -Type (for example AudioVideoAuthentication and OAuthTokenIssuer), when the certificate will become effective defined by -EffectiveDate.</span></span>
  
 <span data-ttu-id="bd9e5-129">**-Roll:** il parametro -Roll è obbligatorio e presenta dipendenze che devono essere fornite insieme a esso.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-129">**-Roll**: The -Roll parameter is required and has dependencies that must be supplied along with it.</span></span> <span data-ttu-id="bd9e5-130">Parametri obbligatori per definire completamente quali certificati saranno interessati e come saranno applicati:</span><span class="sxs-lookup"><span data-stu-id="bd9e5-130">Required parameters to fully define which certificates will be affected and how they will be applied:</span></span>
  
 <span data-ttu-id="bd9e5-131">**-EffectiveDate:** il parametro -EffectiveDate definisce quando il nuovo certificato diventerà co-attivo con il certificato corrente.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-131">**-EffectiveDate**: The parameter -EffectiveDate defines when the new certificate will become co-active with the current certificate.</span></span> <span data-ttu-id="bd9e5-132">-EffectiveDate può essere vicino all'ora di scadenza del certificato corrente oppure può essere un periodo di tempo più lungo.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-132">The -EffectiveDate can be close to the expiry time of the current certificate, or it can be a longer period of time.</span></span> <span data-ttu-id="bd9e5-133">Un valore minimo consigliato per -EffectiveDate per il certificato AudioVideoAuthentication è di 8 ore, ovvero la durata del token predefinita per i token del servizio AV Edge emessi utilizzando il certificato AudioVideoAuthentication.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-133">A recommended minimum -EffectiveDate for the AudioVideoAuthentication certificate would be 8 hours, which is the default token lifetime for AV Edge service tokens issued using the AudioVideoAuthentication certificate.</span></span>
  
<span data-ttu-id="bd9e5-p109">Quando si gestiscono temporaneamente certificati OAuthTokenIssuer, esistono diversi requisiti per il tempo di anticipo prima che il certificato diventi effettivo. Il tempo di anticipo minimo per il certificato OAuthTokenIssuer è di 24 ore prima dell'ora di scadenza del certificato corrente. Il tempo di anticipo prolungato per la coesistenza è dovuto ad altri ruoli del server dipendenti dal certificato OAuthTokenIssuer (ad esempio Exchange Server) che ha un periodo di memorizzazione più lungo per i materiali di autenticazione e chiave di crittografia creati dal certificato.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-p109">When staging OAuthTokenIssuer certificates, there are different requirements for the lead time before the certificate can become effective. The minimum time that the OAuthTokenIssuer certificate should have for its lead time is 24 hours before the expiration time of the current certificate. The extended lead time for the coexistence is because of other server roles that are dependent on the OAuthTokenIssuer certificate (Exchange Server, for example) which has a longer retention time for certificate created authentication and encryption key materials.</span></span>
  
 <span data-ttu-id="bd9e5-137">**-Thumbprint**: l'identificazione digitale è un attributo univoco per il relativo certificato.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-137">**-Thumbprint**: The thumbprint is an attribute on the certificate that is unique to that certificate.</span></span> <span data-ttu-id="bd9e5-138">Il parametro -Thumbprint viene utilizzato per identificare il certificato interessato dalle azioni del cmdlet Set-CsCertificate certificato.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-138">The -Thumbprint parameter is used to identify the certificate that will be affected by the actions of the Set-CsCertificate cmdlet.</span></span>
  
 <span data-ttu-id="bd9e5-139">**-Type:** il parametro -Type può accettare un singolo tipo di utilizzo del certificato o un elenco delimitato da virgole di tipi di utilizzo dei certificati.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-139">**-Type**: The -Type parameter can accept a single certificate usage type or a comma separated list of certificate usage types.</span></span> <span data-ttu-id="bd9e5-140">I tipi di certificati identificato lo scopo del certificato per il cmdlet e il server.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-140">The certificate types are those that identify to the cmdlet and to the server what the purpose of the certificate is.</span></span> <span data-ttu-id="bd9e5-141">Ad esempio, digitare AudioVideoAuthentication è per l'uso da parte del servizio A/V Edge e del servizio di autenticazione AV.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-141">For example, type AudioVideoAuthentication is for use by the A/V Edge service and the AV Authentication service.</span></span> <span data-ttu-id="bd9e5-142">Se si decide di gestire temporaneamente ed effettuare il provisioning di certificati di un tipo diverso contemporaneamente, è necessario considerare il più lungo tempo di anticipo effettivo minimo richiesto per i certificati.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-142">If you decide to stage and provision certificates of a different type at the same time, you must consider the longest required minimum effective lead time for the certificates.</span></span> <span data-ttu-id="bd9e5-143">Ad esempio, è necessario gestire temporaneamente i certificati di tipo AudioVideoAuthentication e OAuthTokenIssuer.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-143">For example, you need to stage certificates of type AudioVideoAuthentication and OAuthTokenIssuer.</span></span> <span data-ttu-id="bd9e5-144">Il valore minimo -EffectiveDate deve essere il maggiore dei due certificati, in questo caso OAuthTokenIssuer, che ha un lead time minimo di 24 ore.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-144">Your minimum -EffectiveDate must be the greater of the two certificates, in this case the OAuthTokenIssuer, which has a minimum lead time of 24 hours.</span></span> <span data-ttu-id="bd9e5-145">Se non si desidera gestire temporaneamente il certificato AudioVideoAuthentication con un tempo di anticipo di 24 ore, gestirlo separatamente con un valore di EffectiveDate più adeguato ai requisiti specifici.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-145">If you do not want to stage the AudioVideoAuthentication certificate with a lead time of 24 hours, stage it separately with an EffectiveDate that is more to your requirements.</span></span>
  
### <a name="to-update-or-renew-an-av-edge-service-certificate-with-a--roll-and--effectivedate-parameters"></a><span data-ttu-id="bd9e5-146">Per aggiornare o rinnovare un certificato del servizio A/V Edge con i parametri -Roll e -EffectiveDate</span><span class="sxs-lookup"><span data-stu-id="bd9e5-146">To update or renew an A/V Edge service certificate with a -Roll and -EffectiveDate parameters</span></span>

1. <span data-ttu-id="bd9e5-147">Accedere al computer locale come membro del gruppo Administrators.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-147">Log on to the local computer as a member of the Administrators group.</span></span>
    
2. <span data-ttu-id="bd9e5-148">Richiedere un rinnovo o un nuovo certificato AudioVideoAuthentication con chiave privata esportabile per il certificato esistente nel servizio A/V Edge.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-148">Request a renewal or new AudioVideoAuthentication certificate with exportable private key for the existing certificate on the A/V Edge service.</span></span>
    
3. <span data-ttu-id="bd9e5-149">Importare il nuovo certificato AudioVideoAuthentication nel server perimetrale e in tutti gli altri server perimetrali nel pool (se è stato distribuito un pool).</span><span class="sxs-lookup"><span data-stu-id="bd9e5-149">Import the new AudioVideoAuthentication certificate to the Edge Server and all other Edge Server in your pool (if you have a pool deployed).</span></span>
    
4. <span data-ttu-id="bd9e5-150">Configurare il certificato importato con il cmdlet Set-CsCertificate e utilizzare il parametro -Roll con il parametro -EffectiveDate.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-150">Configure the imported certificate with the Set-CsCertificate cmdlet and use the -Roll parameter with the -EffectiveDate parameter.</span></span> <span data-ttu-id="bd9e5-151">La data effettiva deve essere definita come ora di scadenza del certificato corrente (14:00:00 o 2:00:00 PM) meno la durata del token (otto ore per impostazione predefinita).</span><span class="sxs-lookup"><span data-stu-id="bd9e5-151">The effective date should be defined as the current certificate expire time (14:00:00, or 2:00:00 PM) minus token lifetime (by default eight hours).</span></span> <span data-ttu-id="bd9e5-152">In questo modo, il certificato deve essere impostato su attivo ed è -EffectiveDate \<string\> : "7/22/2015 6:00:00 AM".</span><span class="sxs-lookup"><span data-stu-id="bd9e5-152">This gives us a time that the certificate must be set to active, and is the -EffectiveDate \<string\>: "7/22/2015 6:00:00 AM".</span></span> 
    
    > [!IMPORTANT]
    > <span data-ttu-id="bd9e5-153">Per un pool di server perimetrali, è necessario distribuire tutti i certificati AudioVideoAuthentication ed eseguirne il provisioning in base alla data e all'ora definite dal parametro -EffectiveDate del primo certificato distribuito per evitare possibili interruzioni delle comunicazioni A/V a causa della scadenza del certificato precedente prima che tutti i token client e consumer siano stati rinnovati utilizzando il nuovo certificato.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-153">For an Edge pool, you must have all AudioVideoAuthentication certificates deployed and provisioned by the date and time defined by the -EffectiveDate parameter of the first certificate deployed to avoid possible A/V communications disruption due to the older certificate expiring before all client and consumer tokens have been renewed using the new certificate.</span></span> 
  
    <span data-ttu-id="bd9e5-154">Il Set-CsCertificate comando con il parametro -Roll e -EffectiveTime:</span><span class="sxs-lookup"><span data-stu-id="bd9e5-154">The Set-CsCertificate command with the -Roll and -EffectiveTime parameter:</span></span>
    
   ```PowerShell
   Set-CsCertificate -Type AudioVideoAuthentication -Thumbprint
          <thumb print of new certificate> -Roll -EffectiveDate <date and time
          for certificate to become active>
   ```

    <span data-ttu-id="bd9e5-155">Esempio di comando Set-CsCertificate:</span><span class="sxs-lookup"><span data-stu-id="bd9e5-155">An example Set-CsCertificate command:</span></span>
    
   ```PowerShell
   Set-CsCertificate -Type AudioVideoAuthentication -Thumbprint
          "B142918E463981A76503828BB1278391B716280987B" -Roll -EffectiveDate "7/22/2015
          6:00:00 AM"
   ```

    > [!IMPORTANT]
    > <span data-ttu-id="bd9e5-156">Il valore EffectiveDate deve essere formattato in modo che corrisponda alle impostazioni internazionali e della lingua del server.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-156">The EffectiveDate must be formatted to match your server's region and language settings.</span></span> <span data-ttu-id="bd9e5-157">Nell'esempio vengono utilizzate le impostazioni di paese e lingua Inglese (Stati Uniti).</span><span class="sxs-lookup"><span data-stu-id="bd9e5-157">The example uses the US English Region and Language settings</span></span> 
  
<span data-ttu-id="bd9e5-158">Per comprendere ulteriormente il processo utilizzato da Set-CsCertificate, -Roll e -EffectiveDate per impostare un nuovo certificato per l'emissione di nuovi token AudioVideoAuthentication, pur utilizzando un certificato esistente per convalidare AudioVideoAuthentication in uso dai consumer, una sequenza temporale visiva è un mezzo efficace per comprendere il processo.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-158">To further understand the process that Set-CsCertificate, -Roll, and -EffectiveDate use to stage a new certificate for issuing new AudioVideoAuthentication tokens while still using an existing certificate to validate AudioVideoAuthentication that are in use by consumers, a visual timeline is an effective means of understanding the process.</span></span> <span data-ttu-id="bd9e5-159">Nell'esempio seguente, l'amministratore determina che il certificato del servizio A/V Edge deve scadere alle 14:00 del 22/07/2015.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-159">In the following example, the administrator determines that the A/V Edge service certificate is due to expire at 2:00:00 PM on 07/22/2015.</span></span> <span data-ttu-id="bd9e5-160">Richiede e riceve un nuovo certificato e lo importa in ogni server perimetrale del pool.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-160">He requests and receives a new certificate and imports it to each Edge Server in his pool.</span></span> <span data-ttu-id="bd9e5-161">Alle 2 del 22/07/2015 inizia l'esecuzione di Get-CsCertificate con -Roll, -Thumbprint uguale alla stringa di identificazione personale del nuovo certificato e -EffectiveTime impostato su 22/07/2015 6:00:00 AM.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-161">At 2 AM on 07/22/2015, he begins running Get-CsCertificate with -Roll, -Thumbprint equal to the thumbprint string of the new certificate, and -EffectiveTime set to 07/22/2015 6:00:00 AM.</span></span> <span data-ttu-id="bd9e5-162">Esegue questo comando in ogni server perimetrale.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-162">He runs this command on each Edge Server.</span></span>
  
![Utilizzo dei parametri Roll e EffectiveDate.](../../media/Ops_Certificate_Set_Roll_EffectiveTime_Timeline.jpg)
  
|<span data-ttu-id="bd9e5-164">**Callout**</span><span class="sxs-lookup"><span data-stu-id="bd9e5-164">**Callout**</span></span>|<span data-ttu-id="bd9e5-165">**Fase**</span><span class="sxs-lookup"><span data-stu-id="bd9e5-165">**Stage**</span></span>|
|:-----|:-----|
|<span data-ttu-id="bd9e5-166">1 </span><span class="sxs-lookup"><span data-stu-id="bd9e5-166">1</span></span>  <br/> |<span data-ttu-id="bd9e5-167">Inizio: 22/07/2015 12.00.00</span><span class="sxs-lookup"><span data-stu-id="bd9e5-167">Start: 7/22/2015 12:00:00 AM</span></span>  <br/> <span data-ttu-id="bd9e5-168">Il certificato AudioVideoAuthentication corrente deve scadere alle 14:00 del 22/07/2015.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-168">The current AudioVideoAuthentication certificate is due to expire at 2:00:00 PM on 7/22/2015.</span></span> <span data-ttu-id="bd9e5-169">Ciò è determinato dall'indicatore di data e ora di scadenza nel certificato.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-169">This is determined by the expires time stamp on the certificate.</span></span> <span data-ttu-id="bd9e5-170">Pianificare la sostituzione e il rollover del certificato per l'esecuzione di una sovrapposizione di 8 ore (durata del token predefinita) prima che il certificato esistente raggiunga la scadenza.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-170">Plan your certificate replacement and rollover to account for an 8 hour overlap (default token lifetime) before the existing certificate reaches the expire time.</span></span> <span data-ttu-id="bd9e5-171">Il lead time 2:00:00 am viene utilizzato in questo esempio per consentire all'amministratore un tempo adeguato per collocare ed eseguire il provisioning dei nuovi certificati prima del tempo di validità delle 6:00:00.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-171">The 2:00:00 AM lead time is used in this example to allow the administrator adequate time to place and provision the new certificates in advance of the 6:00:00 AM effective time.</span></span>  <br/> |
|<span data-ttu-id="bd9e5-172">2 </span><span class="sxs-lookup"><span data-stu-id="bd9e5-172">2</span></span>  <br/> |<span data-ttu-id="bd9e5-173">22/07/2015 02:00:00 - 22/07/2015 05:59:59</span><span class="sxs-lookup"><span data-stu-id="bd9e5-173">7/22/2015 2:00:00 AM - 7/22/2015 5:59:59 AM</span></span>  <br/> <span data-ttu-id="bd9e5-174">Impostare i certificati nei server perimetrali con tempo effettivo di 6:00:00 (4 ore di lead time è per questo esempio, ma può essere più lungo) utilizzando Set-CsCertificate -Type \<certificate usage type\> -Thumbprint \<thumbprint of new certificate\> -Roll -EffectiveDate \<datetime string of the effective time for new certificate\></span><span class="sxs-lookup"><span data-stu-id="bd9e5-174">Set Certificates on Edge Servers with effective time of 6:00:00 AM (4 hour lead time is for this example, but can be longer) using Set-CsCertificate -Type \<certificate usage type\> -Thumbprint \<thumbprint of new certificate\> -Roll -EffectiveDate \<datetime string of the effective time for new certificate\></span></span>  <br/> |
|<span data-ttu-id="bd9e5-175">3 </span><span class="sxs-lookup"><span data-stu-id="bd9e5-175">3</span></span>  <br/> |<span data-ttu-id="bd9e5-176">22/07/2015 06.00 - 22/07/2015 14.00</span><span class="sxs-lookup"><span data-stu-id="bd9e5-176">7/22/2015 6:00 AM - 7/22/2015 2:00 PM</span></span>  <br/> <span data-ttu-id="bd9e5-177">Per convalidare i token, viene eseguito un tentativo per primo del nuovo certificato e, se il nuovo certificato non riesce a convalidare il token, viene tentato il vecchio certificato.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-177">To validate tokens, the new certificate is tried first, and if the new certificate fails to validate the token, the old certificate is tried.</span></span> <span data-ttu-id="bd9e5-178">Questo processo viene usato per tutti i token durante il periodo di sovrapposizione di 8 ore (durata dei token predefinita).</span><span class="sxs-lookup"><span data-stu-id="bd9e5-178">This process is used for all tokens during the 8 hour (default token lifetime) overlap period.</span></span>  <br/> |
|<span data-ttu-id="bd9e5-179">4 </span><span class="sxs-lookup"><span data-stu-id="bd9e5-179">4</span></span>  <br/> |<span data-ttu-id="bd9e5-180">Fine: 22/07/2015 14:00:01</span><span class="sxs-lookup"><span data-stu-id="bd9e5-180">End: 7/22/2015 2:00:01 PM</span></span>  <br/> <span data-ttu-id="bd9e5-181">Il vecchio certificato è scaduto e il nuovo certificato è stato assunto.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-181">Old certificate has expired and the new certificate has taken over.</span></span> <span data-ttu-id="bd9e5-182">Il vecchio certificato può essere rimosso in modo sicuro con Remove-CsCertificate -Type \<certificate usage type\> -Previous</span><span class="sxs-lookup"><span data-stu-id="bd9e5-182">Old certificate can be safely removed with Remove-CsCertificate -Type \<certificate usage type\> -Previous</span></span>  <br/> |
   
<span data-ttu-id="bd9e5-183">Quando viene raggiunto il tempo effettivo (22/07/2015 6.00.00), tutti i nuovi token vengono emessi dal nuovo certificato.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-183">When the effective time is reached (7/22/2015 6:00:00 AM), all new tokens are issued by the new certificate.</span></span> <span data-ttu-id="bd9e5-184">Durante la convalida dei token, i token verranno prima convalidati in base al nuovo certificato.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-184">When validating tokens, tokens will first be validated against the new certificate.</span></span> <span data-ttu-id="bd9e5-185">Se la convalida ha esito negativo, viene tentato il vecchio certificato.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-185">If the validation fails, the old certificate is tried.</span></span> <span data-ttu-id="bd9e5-186">Il processo di prova del nuovo certificato e di ripristino del vecchio certificato continuerà fino alla scadenza del vecchio certificato.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-186">The process of trying the new and falling back to the old certificate will continue until the expiry time of the old certificate.</span></span> <span data-ttu-id="bd9e5-187">Una volta scaduto il vecchio certificato (22/07/2015 14.00), i token verranno convalidati solo dal nuovo certificato.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-187">Once the old certificate has expired (7/22/2015 2:00:00 PM), tokens will only be validated by the new certificate.</span></span> <span data-ttu-id="bd9e5-188">Il vecchio certificato può essere rimosso in modo sicuro utilizzando il cmdlet Remove-CsCertificate con il parametro -Previous.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-188">The old certificate can be safely removed using the Remove-CsCertificate cmdlet with the -Previous parameter.</span></span>

```PowerShell
Remove-CsCertificate -Type AudioVideoAuthentication -Previous
```

### <a name="to-update-or-renew-an-oauthtokenissuer-certificate-with-a--roll-and--effectivedate-parameters"></a><span data-ttu-id="bd9e5-189">Per aggiornare o rinnovare un certificato OAuthTokenIssuer con i parametri -Roll ed -EffectiveDate</span><span class="sxs-lookup"><span data-stu-id="bd9e5-189">To update or renew an OAuthTokenIssuer certificate with a -Roll and -EffectiveDate parameters</span></span>

1. <span data-ttu-id="bd9e5-190">Accedere al computer locale come membro del gruppo Administrators.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-190">Log on to the local computer as a member of the Administrators group.</span></span>
    
2. <span data-ttu-id="bd9e5-191">Richiedere un rinnovo o un nuovo certificato OAuthTokenIssuer con chiave privata esportabile per il certificato esistente nel Front End Server.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-191">Request a renewal or new OAuthTokenIssuer certificate with exportable private key for the existing certificate on the Front End Server.</span></span>
    
3. <span data-ttu-id="bd9e5-192">Importare il nuovo certificato OAuthTokenIssuer in un Front End Server nel pool (se è stato distribuito un pool).</span><span class="sxs-lookup"><span data-stu-id="bd9e5-192">Import the new OAuthTokenIssuer certificate to a Front End Server in your pool (if you have a pool deployed).</span></span> <span data-ttu-id="bd9e5-193">Il certificato OAuthTokenIssuer viene replicato globalmente e deve solo essere aggiornato e rinnovato in ogni server nella distribuzione.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-193">The OAuthTokenIssuer certificate is replicated globally and only needs to be updated and renewed at any server in your deployment.</span></span> <span data-ttu-id="bd9e5-194">Il Front End Server viene utilizzato come esempio.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-194">The Front End Server is used as an example.</span></span>
    
4. <span data-ttu-id="bd9e5-195">Configurare il certificato importato con il cmdlet Set-CsCertificate e utilizzare il parametro -Roll con il parametro -EffectiveDate.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-195">Configure the imported certificate with the Set-CsCertificate cmdlet and use the -Roll parameter with the -EffectiveDate parameter.</span></span> <span data-ttu-id="bd9e5-196">La data effettiva deve essere definita come ora di scadenza del certificato corrente (14:00:00 o 2:00:00 PM) meno un minimo di 24 ore.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-196">The effective date should be defined as the current certificate expire time (14:00:00, or 2:00:00 PM) minus a minimum of 24 hours.</span></span> 
    
    <span data-ttu-id="bd9e5-197">Il Set-CsCertificate comando con il parametro -Roll e -EffectiveTime:</span><span class="sxs-lookup"><span data-stu-id="bd9e5-197">The Set-CsCertificate command with the -Roll and -EffectiveTime parameter:</span></span>
    
   ```PowerShell
   Set-CsCertificate -Type OAuthTokenIssuer -Thumbprint <thumb
          print of new certificate> -Roll -EffectiveDate <date and time for
          certificate to become active> -identity Global 
   ```

<span data-ttu-id="bd9e5-198">Esempio di comando Set-CsCertificate:</span><span class="sxs-lookup"><span data-stu-id="bd9e5-198">An example Set-CsCertificate command:</span></span>
    
  ```PowerShell
  Set-CsCertificate -Type OAuthTokenIssuer -Thumbprint
          "B142918E463981A76503828BB1278391B716280987B" -Roll -EffectiveDate "7/21/2015
          1:00:00 PM" 
  ```

> [!IMPORTANT]
> <span data-ttu-id="bd9e5-199">Il valore EffectiveDate deve essere formattato in modo che corrisponda alle impostazioni internazionali e della lingua del server.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-199">The EffectiveDate must be formatted to match your server's region and language settings.</span></span> <span data-ttu-id="bd9e5-200">Nell'esempio vengono utilizzate le impostazioni di paese e lingua Inglese (Stati Uniti).</span><span class="sxs-lookup"><span data-stu-id="bd9e5-200">The example uses the US English Region and Language settings</span></span> 
  
<span data-ttu-id="bd9e5-201">Quando viene raggiunto il tempo effettivo (21/07/2015 1.00.00), tutti i nuovi token vengono emessi dal nuovo certificato.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-201">When the effective time is reached (7/21/2015 1:00:00 AM), all new tokens are issued by the new certificate.</span></span> <span data-ttu-id="bd9e5-202">Durante la convalida dei token, i token verranno prima convalidati in base al nuovo certificato.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-202">When validating tokens, tokens will first be validated against the new certificate.</span></span> <span data-ttu-id="bd9e5-203">Se la convalida ha esito negativo, viene tentato il vecchio certificato.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-203">If the validation fails, the old certificate is tried.</span></span> <span data-ttu-id="bd9e5-204">Il processo di prova del nuovo certificato e di ripristino del vecchio certificato continuerà fino alla scadenza del vecchio certificato.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-204">The process of trying the new and falling back to the old certificate will continue until the expiry time of the old certificate.</span></span> <span data-ttu-id="bd9e5-205">Una volta scaduto il vecchio certificato (22/07/2015 14.00), i token verranno convalidati solo dal nuovo certificato.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-205">Once the old certificate has expired (7/22/2015 2:00:00 PM), tokens will only be validated by the new certificate.</span></span> <span data-ttu-id="bd9e5-206">Il vecchio certificato può essere rimosso in modo sicuro utilizzando il cmdlet Remove-CsCertificate con il parametro -Previous.</span><span class="sxs-lookup"><span data-stu-id="bd9e5-206">The old certificate can be safely removed using the Remove-CsCertificate cmdlet with the -Previous parameter.</span></span>
```PowerShell
Remove-CsCertificate -Type OAuthTokenIssuer -Previous 
```

## <a name="see-also"></a><span data-ttu-id="bd9e5-207">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="bd9e5-207">See also</span></span>

[<span data-ttu-id="bd9e5-208">Gestire l'autenticazione da server a server (OAuth) e le applicazioni partner in Skype for Business Server</span><span class="sxs-lookup"><span data-stu-id="bd9e5-208">Manage server-to-server authentication (OAuth) and partner applications in Skype for Business Server</span></span>](server-to-server-and-partner-applications.md)

[<span data-ttu-id="bd9e5-209">Set-CsCertificate</span><span class="sxs-lookup"><span data-stu-id="bd9e5-209">Set-CsCertificate</span></span>](https://docs.microsoft.com/powershell/module/skype/set-cscertificate?view=skype-ps)
  
[<span data-ttu-id="bd9e5-210">Remove-CsCertificate</span><span class="sxs-lookup"><span data-stu-id="bd9e5-210">Remove-CsCertificate</span></span>](https://docs.microsoft.com/powershell/module/skype/remove-cscertificate?view=skype-ps)
