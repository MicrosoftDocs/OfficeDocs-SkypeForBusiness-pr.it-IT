---
title: Configurare la messaggistica unificata di Exchange Server per la segreteria telefonica di Skype for Business Server
ms.reviewer: ''
ms.author: v-cichur
author: cichur
manager: serdars
ms.date: 2/11/2019
audience: ITPro
ms.topic: quickstart
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
localization_priority: Normal
ms.collection: IT_Skype16
ms.assetid: 1be9c4f4-fd8e-4d64-9798-f8737b12e2ab
description: 'Riepilogo: configurare la messaggistica unificata di Exchange Server per la segreteria telefonica di Skype for Business Server.'
ms.openlocfilehash: 68cf4a11deccac9ad71bdb6216c4126362787498
ms.sourcegitcommit: c528fad9db719f3fa96dc3fa99332a349cd9d317
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/12/2021
ms.locfileid: "49834036"
---
# <a name="configure-exchange-server-unified-messaging-for-skype-for-business-server-voice-mail"></a><span data-ttu-id="14640-103">Configurare la messaggistica unificata di Exchange Server per la segreteria telefonica di Skype for Business Server</span><span class="sxs-lookup"><span data-stu-id="14640-103">Configure Exchange Server Unified Messaging for Skype for Business Server voice mail</span></span>
 
<span data-ttu-id="14640-104">**Riepilogo:** Configurare la messaggistica unificata di Exchange Server per la segreteria telefonica di Skype for Business Server.</span><span class="sxs-lookup"><span data-stu-id="14640-104">**Summary:** Configure Exchange Server Unified Messaging for Skype for Business Server voice mail.</span></span>
  
<span data-ttu-id="14640-105">Skype for Business Server consente di archiviare i messaggi in segreteria telefonica in Exchange Server 2016 o Exchange Server 2013; i messaggi vocali verranno quindi visualizzati come messaggi di posta elettronica nelle cassette postali degli utenti.</span><span class="sxs-lookup"><span data-stu-id="14640-105">Skype for Business Server enables you to have voicemail messages stored in Exchange Server 2016 or Exchange Server 2013; those voicemail messages will then appear as email messages in your users' Inboxes.</span></span> 

> [!NOTE]
> <span data-ttu-id="14640-106">La messaggistica unificata di Exchange come precedentemente nota non è più disponibile in Exchange 2019, ma è comunque possibile utilizzare il sistema telefonico per registrare i messaggi vocali e quindi lasciare la registrazione nella cassetta postale di Exchange di un utente.</span><span class="sxs-lookup"><span data-stu-id="14640-106">Exchange Unified Messaging as previously known is no longer available in Exchange 2019, but you can still use Phone System to record voicemail messages and then leave the recording in a user's Exchange mailbox.</span></span> <span data-ttu-id="14640-107">Per ulteriori informazioni, vedere [Plan cloud Voicemail Service](../../../sfbhybrid/hybrid/plan-cloud-voicemail.md) .</span><span class="sxs-lookup"><span data-stu-id="14640-107">See [Plan Cloud Voicemail service](../../../sfbhybrid/hybrid/plan-cloud-voicemail.md) for more information.</span></span>
  
<span data-ttu-id="14640-108">Se è già stata configurata l'autenticazione da server a server tra Skype for Business Server e Exchange Server 2016 o Exchange Server 2013, si è pronti per l'installazione della messaggistica unificata.</span><span class="sxs-lookup"><span data-stu-id="14640-108">If you have already configured server-to-server authentication between Skype for Business Server and Exchange Server 2016 or Exchange Server 2013, then you are ready to setup unified messaging.</span></span> <span data-ttu-id="14640-109">A tale scopo, è necessario innanzitutto creare e assegnare un nuovo dial plan di messaggistica unificata nel server Exchange.</span><span class="sxs-lookup"><span data-stu-id="14640-109">To do so, you must first create and assign a new unified messaging dial plan on your Exchange Server.</span></span> <span data-ttu-id="14640-110">Ad esempio, questi due comandi (eseguiti dall'interno di Exchange Management Shell) configurano un nuovo dial plan a tre cifre per Exchange:</span><span class="sxs-lookup"><span data-stu-id="14640-110">For example, these two commands (run from within the Exchange Management Shell) configure a new 3-digit dial plan for Exchange:</span></span>
  
```powershell
New-UMDialPlan -Name "RedmondDialPlan" -VoIPSecurity "Secured" -NumberOfDigitsInExtension 3 -URIType "SipName" -CountryOrRegionCode 1
Set-UMDialPlan "RedmondDialPlan" -ConfiguredInCountryOrRegionGroups "Anywhere,*,*,*" -AllowedInCountryOrRegionGroups "Anywhere"
```

<span data-ttu-id="14640-111">Nel primo comando dell'esempio, il parametro VoIPSecurity e il valore del parametro "Secured" indicano che il canale di segnalazione è crittografato tramite TLS (Transport Layer Security).</span><span class="sxs-lookup"><span data-stu-id="14640-111">In the first command in the example, the VoIPSecurity parameter, and the parameter value "Secured" indicates that the signaling channel is encrypted by using Transport Layer Security (TLS).</span></span> <span data-ttu-id="14640-112">Il parametro URIType "SipName" indica che i messaggi verranno inviati e ricevuti tramite il protocollo SIP e il valore 1 per CountryOrRegionCode indica che il dial plan si applica agli Stati Uniti.</span><span class="sxs-lookup"><span data-stu-id="14640-112">The URIType "SipName" indicates that messages will be sent and received using the SIP protocol, and the CountryOrRegionCode of 1 indicates that the dial plan applies to the US.</span></span>
  
<span data-ttu-id="14640-113">Nel secondo comando il valore di parametro passato al parametro ConfiguredInCountryOrRegionGroups specifica quali gruppi nazionali è possibile utilizzare con questo dial plan.</span><span class="sxs-lookup"><span data-stu-id="14640-113">In the second command, the parameter value passed to the ConfiguredInCountryOrRegionGroups parameter specifies the in-country groups that can be used with this dial plan.</span></span> <span data-ttu-id="14640-114">Il valore del parametro "Anywhere \* , \* , \* " consente di impostare gli elementi seguenti:</span><span class="sxs-lookup"><span data-stu-id="14640-114">The parameter value "Anywhere,\*,\*,\*" sets the following:</span></span>
  
- <span data-ttu-id="14640-115">Nome gruppo</span><span class="sxs-lookup"><span data-stu-id="14640-115">Group name ("Anywhere")</span></span>
    
- <span data-ttu-id="14640-116">AllowedNumberString ( \* un carattere jolly che indica che è consentita una stringa di numero qualsiasi)</span><span class="sxs-lookup"><span data-stu-id="14640-116">AllowedNumberString (\*, a wildcard character indicating that any number string is allowed)</span></span>
    
- <span data-ttu-id="14640-117">DialNumberString ( \* un carattere jolly che indica che è consentito qualsiasi numero composto)</span><span class="sxs-lookup"><span data-stu-id="14640-117">DialNumberString (\*, a wildcard character indicating that any dialed number is allowed)</span></span>
    
- <span data-ttu-id="14640-118">TextComment ( \* un carattere jolly che indica che è consentito qualsiasi comando di testo)</span><span class="sxs-lookup"><span data-stu-id="14640-118">TextComment (\*, a wildcard character indicating that any text command is allowed)</span></span>
    
> [!NOTE]
> <span data-ttu-id="14640-119">Se si crea un nuovo dial plan, verrà creato anche un criterio cassetta postale predefinito.</span><span class="sxs-lookup"><span data-stu-id="14640-119">Creating a new dial plan will also create a Default Mailbox Policy.</span></span> 
  
<span data-ttu-id="14640-120">Dopo aver creato e configurato il nuovo dial plan, è necessario aggiungerlo al server di messaggistica unificata, quindi impostare la modalità di avvio su "Doppio".</span><span class="sxs-lookup"><span data-stu-id="14640-120">After creating and configuring the new dial plan you must add the new dial plan to your unified messaging server and then modify the startup mode of that server; in particular, you must set the startup mode to "Dual".</span></span> <span data-ttu-id="14640-121">È possibile eseguire entrambe queste attività dall'interno di Exchange Management Shell:</span><span class="sxs-lookup"><span data-stu-id="14640-121">You can perform both of these tasks from within the Exchange Management Shell:</span></span>
  
```powershell
Set-UmService -Identity "atl-exchangeum-001.litwareinc.com" -DialPlans "RedmondDialPlan" -UMStartupMode "Dual"
```

<span data-ttu-id="14640-122">Dopo aver configurato il server Messaggistica unificata, è necessario eseguire il cmdlet Enable-ExchangeCertificate per assicurarsi che il certificato di Exchange venga applicato al servizio di messaggistica unificata:</span><span class="sxs-lookup"><span data-stu-id="14640-122">After the unified messaging server has been configured you should next run the Enable-ExchangeCertificate cmdlet to ensure that your Exchange certificate is applied to the unified messaging service:</span></span>
  
```powershell
Enable-ExchangeCertificate -Server "atl-umserver-001.litwareinc.com" -Thumbprint "EA5A332496CC05DA69B75B66111C0F78A110D22d" -Services "SMTP","IIS","UM"
```

<span data-ttu-id="14640-p106">Dopo avere assegnato correttamente il certificato, è quindi necessario arrestare e riavviare il servizio MsExchangeUM sul server di messaggistica unificata. È necessario arrestare e riavviare il servizio ogni volta che si modifica la modalità di avvio.</span><span class="sxs-lookup"><span data-stu-id="14640-p106">After the certificate has been correctly assigned you must then stop and restart the MsExchangeUM service on the unified messaging server. This service must be stopped and restarted any time you change the startup mode.</span></span>
  
<span data-ttu-id="14640-125">Al termine della configurazione del server di messaggistica unificata, è quindi possibile configurare il Router chiamate di messaggistica unificata:</span><span class="sxs-lookup"><span data-stu-id="14640-125">After finishing configuration of the unified messaging server you can then configure the UM Call Router:</span></span>
  
```powershell
Set-UMCallRouterSettings -Server "atl-exchange-001.litwareinc.com" -UMStartupMode "Dual" -DialPlans "RedmondDialPlan" 
Enable-ExchangeCertificate -Server "atl-umserver-001.litwareinc.com" -Thumbprint "45BAA32496CC891169B75B9811320F78A1075DDA" -Services "IIS","UMCallRouter"
```

<span data-ttu-id="14640-126">Dato che la modalità di avvio è stata modificata, è necessario arrestare e riavviare il servizio MsExchangeUMCR nel computer che ospita il router chiamate di messaggistica unificata.</span><span class="sxs-lookup"><span data-stu-id="14640-126">Because the startup mode has changed you must stop and restart the MsExchangeUMCR service on the computer hosting the UM Call Router.</span></span>
  
<span data-ttu-id="14640-p107">Per completare l'impostazione della messaggistica unificata, è quindi necessario creare criteri di cassetta postale di messaggistica unificata e utilizzare tali criteri per abilitare la messaggistica unificata per gli utenti. È possibile creare criteri di cassetta postale tramite un comando simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="14640-p107">To complete the unified messaging setup, you then need to create a UM mailbox policy and then use that policy to enable users for unified messaging. You can create a mailbox policy by using a command similar to this:</span></span>
  
```powershell
New-UMMailboxPolicy -Name "RedmondMailboxPolicy" -AllowedInCountryOrRegionGroups "Anywhere"
```

<span data-ttu-id="14640-129">È possibile abilitare la messaggistica unificata per un utente tramite un comando simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="14640-129">And you can enable a user for unified messaging by using a command similar to this:</span></span>
  
```powershell
Enable-UMMailbox -Extensions 100 -SIPResourceIdentifier "kenmyer@litwareinc.com" -Identity "litwareinc\kenmyer" -UMMailboxPolicy "RedmondMailboxPolicy"
```

<span data-ttu-id="14640-p108">Nel comando precedente, il parametro Extensions rappresenta il numero di interno telefonico dell'utente. In questo esempio l'utente ha l'interno 100.</span><span class="sxs-lookup"><span data-stu-id="14640-p108">In the preceding command, the Extensions parameter represents the telephone extension number for the user. In this example, the user has the extension number 100.</span></span>
  
<span data-ttu-id="14640-132">Dopo averne abilitato la cassetta postale, l'utente kenmyer@litwareinc.com dovrebbe essere in grado di utilizzare la messaggistica unificata di Exchange.</span><span class="sxs-lookup"><span data-stu-id="14640-132">After you have enabled his mailbox, the user kenmyer@litwareinc.com should be able to use Exchange unified messaging.</span></span> <span data-ttu-id="14640-133">È possibile verificare che l'utente possa connettersi alla messaggistica unificata di Exchange eseguendo il cmdlet [test-CsExUMConnectivity](https://docs.microsoft.com/powershell/module/skype/test-csexumconnectivity?view=skype-ps) da Skype for Business Server Management Shell:</span><span class="sxs-lookup"><span data-stu-id="14640-133">You can verify that the user can connect to Exchange UM by running the [Test-CsExUMConnectivity](https://docs.microsoft.com/powershell/module/skype/test-csexumconnectivity?view=skype-ps) cmdlet from within the Skype for Business Server Management Shell:</span></span>
  
```powershell
$credential = Get-Credential "litwareinc\kenmyer"
Test-CsExUMConnectivity -TargetFqdn "atl-cs-001.litwareinc.com" -UserSipAddress "sip:kenmyer@litwareinc.com" -UserCredential $credential
```

<span data-ttu-id="14640-134">Se è presente un secondo utente per cui è stata abilitata la messaggistica unificata, è possibile utilizzare il cmdlet [Test-CsExUMVoiceMail](https://docs.microsoft.com/powershell/module/skype/test-csexumvoicemail?view=skype-ps) per verificare che possa lasciare un messaggio della segreteria telefonica per il primo utente.</span><span class="sxs-lookup"><span data-stu-id="14640-134">If you have a second user who has been enabled for unified messaging you can use the [Test-CsExUMVoiceMail](https://docs.microsoft.com/powershell/module/skype/test-csexumvoicemail?view=skype-ps) cmdlet to verify that this second user can leave a voicemail message for the first user.</span></span>
  
```powershell
$credential = Get-Credential "litwareinc\pilar"
Test-CsExUMVoiceMail -TargetFqdn "atl-cs-001.litwareinc.com" -ReceiverSipAddress "sip:kenmyer@litwareinc.com" -SenderSipAddress "sip:pilar@litwareinc.com" -SenderCredential $credential
```



## <a name="configuring-unified-messaging-on-microsoft-exchange-server"></a><span data-ttu-id="14640-135">Configurazione della messaggistica unificata in Microsoft Exchange Server</span><span class="sxs-lookup"><span data-stu-id="14640-135">Configuring Unified Messaging on Microsoft Exchange Server</span></span> 
> [!IMPORTANT]
> <span data-ttu-id="14640-136">Se si desidera utilizzare la messaggistica unificata di Exchange per fornire i servizi di risponditore automatico, Outlook Voice Access o operatori automatici per gli utenti di VoIP aziendale, leggere [piano per l'integrazione della messaggistica unificata di Exchange in Skype for business](../../plan-your-deployment/integrate-with-exchange/unified-messaging.md)e quindi seguire le istruzioni riportate in questa sezione.</span><span class="sxs-lookup"><span data-stu-id="14640-136">If you want to use Exchange Unified Messaging (UM) to provide call answering, Outlook Voice Access, or auto-attendant services for Enterprise Voice users, read [Plan for Exchange Unified Messaging integration in Skype for Business](../../plan-your-deployment/integrate-with-exchange/unified-messaging.md), and then follow the instructions in this section.</span></span> 

<span data-ttu-id="14640-137">Per configurare la messaggistica unificata di Exchange in modo che funzioni con VoIP aziendale, è necessario eseguire le attività seguenti:</span><span class="sxs-lookup"><span data-stu-id="14640-137">To configure Exchange Unified Messaging (UM) to work with Enterprise Voice, you’ll need to perform the following tasks:</span></span>

- <span data-ttu-id="14640-138">Configurare i certificati nel server che esegue i servizi di messaggistica unificata di Exchange</span><span class="sxs-lookup"><span data-stu-id="14640-138">Configure certificates on the server running Exchange Unified Messaging (UM) services</span></span>
  > [!NOTE]
  > <span data-ttu-id="14640-139">Aggiungere tutti i server Accesso client e cassette postali a tutti i dial plan URI SIP di messaggistica unificata.</span><span class="sxs-lookup"><span data-stu-id="14640-139">Add all Client Access and Mailbox servers to all UM SIP URI dial plans.</span></span> <span data-ttu-id="14640-140">In caso contrario, il routing delle chiamate in uscita non funzionerà come previsto.</span><span class="sxs-lookup"><span data-stu-id="14640-140">If not, outbound call routing won’t work as expected.</span></span> 
- <span data-ttu-id="14640-141">Creare uno o più dial plan URI SIP di messaggistica unificata, insieme ai numeri di telefono di accesso del Sottoscrittore, in base alle esigenze e quindi creare i dial plan di L corrispondenti.</span><span class="sxs-lookup"><span data-stu-id="14640-141">Create one or more UM SIP URI dial plans, along with the subscriber access phone numbers, as needed, and then create corresponding L dial plans.</span></span>

- <span data-ttu-id="14640-142">Utilizzare lo script exchucutil.ps1 per:</span><span class="sxs-lookup"><span data-stu-id="14640-142">Use the exchucutil.ps1 script to:</span></span>
    - <span data-ttu-id="14640-143">Creare gateway IP di messaggistica unificata.</span><span class="sxs-lookup"><span data-stu-id="14640-143">Create UM IP gateways.</span></span>
    - <span data-ttu-id="14640-144">Creare gruppi di risposta di messaggistica unificata.</span><span class="sxs-lookup"><span data-stu-id="14640-144">Create UM hunt groups.</span></span>
    - <span data-ttu-id="14640-145">Concedere l'autorizzazione Skype for Business Server per leggere gli oggetti di servizi di dominio Active Directory di messaggistica unificata.</span><span class="sxs-lookup"><span data-stu-id="14640-145">Grant Skype for Business Server permission to read UM Active Directory Domain Services objects.</span></span>
- <span data-ttu-id="14640-146">Creare un oggetto operatore automatico di messaggistica unificata.</span><span class="sxs-lookup"><span data-stu-id="14640-146">Create a UM auto-attendant object.</span></span>
- <span data-ttu-id="14640-147">Creare un oggetto di accesso sottoscrittore.</span><span class="sxs-lookup"><span data-stu-id="14640-147">Create a subscriber access object.</span></span>
- <span data-ttu-id="14640-148">Creare un URI SIP per ogni utente e associare gli utenti a un dial plan URI SIP di messaggistica unificata.</span><span class="sxs-lookup"><span data-stu-id="14640-148">Create a SIP URI for each user and associating users with a UM SIP URI dial plan.</span></span>

### <a name="requirements-and-recommendations"></a><span data-ttu-id="14640-149">Requisiti e raccomandazioni</span><span class="sxs-lookup"><span data-stu-id="14640-149">Requirements and Recommendations</span></span>

<span data-ttu-id="14640-150">Prima di iniziare, la documentazione in questa sezione presuppone che siano stati distribuiti i ruoli di Exchange seguenti: accesso client e cassetta postale.</span><span class="sxs-lookup"><span data-stu-id="14640-150">Before you begin, the documentation in this section assumes that you have deployed the following Exchange roles: Client Access and Mailbox.</span></span> <span data-ttu-id="14640-151">In Microsoft Exchange Server, la messaggistica unificata di Exchange viene eseguita come servizio su questi server.</span><span class="sxs-lookup"><span data-stu-id="14640-151">In Microsoft Exchange Server, Exchange UM runs as a service on these servers.</span></span>

<span data-ttu-id="14640-152">Tenere inoltre presente quanto segue:</span><span class="sxs-lookup"><span data-stu-id="14640-152">Also note the following:</span></span>
- <span data-ttu-id="14640-153">Se la messaggistica unificata di Exchange è installata in più foreste, è necessario eseguire i passaggi di integrazione di Exchange Server per ogni foresta di messaggistica unificata.</span><span class="sxs-lookup"><span data-stu-id="14640-153">If Exchange UM is installed in multiple forests, the Exchange Server integration steps must be performed for each UM forest.</span></span> <span data-ttu-id="14640-154">Inoltre, ogni foresta di messaggistica unificata deve essere configurata per considerare attendibile la foresta in cui è distribuito Skype for Business Server e la foresta in whichSkype for Business Server è distribuita affinché consideri attendibile ogni foresta di messaggistica unificata.</span><span class="sxs-lookup"><span data-stu-id="14640-154">In addition, each UM forest must be configured to trust the forest in which Skype for Business Server is deployed, and the forest in whichSkype for Business Server is deployed must be configured to trust each UM forest.</span></span>
- <span data-ttu-id="14640-155">I passaggi di integrazione vengono eseguiti sui ruoli del server Exchange in cui sono in esecuzione i servizi di messaggistica unificata e sul server che esegue Skype for Business Server.</span><span class="sxs-lookup"><span data-stu-id="14640-155">Integration steps are performed on both the Exchange Server roles where Unified Messaging services are running, and on the server running Skype for Business Server.</span></span> <span data-ttu-id="14640-156">È consigliabile eseguire i passaggi di integrazione della messaggistica unificata di Exchange Server prima di eseguire i passaggi di integrazione di Lync Server 2013.</span><span class="sxs-lookup"><span data-stu-id="14640-156">You should perform the Exchange Server Unified Messaging integration steps before you perform the Lync Server 2013 integration steps.</span></span>
  > [!NOTE]
  > <span data-ttu-id="14640-157">Per sapere quali passaggi di integrazione vengono eseguiti su quali server e quali ruoli di amministratore, vedere  [Deployment Process Overview per l'integrazione della messaggistica unificata locale e Skype for business](../../plan-your-deployment/integrate-with-exchange/deployment-overview.md).</span><span class="sxs-lookup"><span data-stu-id="14640-157">To see which integration steps are performed on which servers and by which administrator roles, see  [Deployment process overview for integrating on-premises Unified Messaging and Skype for Business](../../plan-your-deployment/integrate-with-exchange/deployment-overview.md).</span></span> 

<span data-ttu-id="14640-158">Gli strumenti seguenti devono essere disponibili in ogni server che esegue la messaggistica unificata di Exchange:</span><span class="sxs-lookup"><span data-stu-id="14640-158">The following tools must be available on each server running Exchange UM:</span></span>
- <span data-ttu-id="14640-159">Exchange Management Shell</span><span class="sxs-lookup"><span data-stu-id="14640-159">Exchange Management Shell</span></span>
- <span data-ttu-id="14640-160">Script exchucutil.ps1, che consente di eseguire le attività seguenti:</span><span class="sxs-lookup"><span data-stu-id="14640-160">The script exchucutil.ps1, which performs the following tasks:</span></span>
    - <span data-ttu-id="14640-161">Crea un gateway IP di messaggistica unificata per ogni server Skype for business.</span><span class="sxs-lookup"><span data-stu-id="14640-161">Creates a UM IP gateway for each Skype for Business Server.</span></span>
    - <span data-ttu-id="14640-162">Creazione di un gruppo di risposta per ogni gateway.</span><span class="sxs-lookup"><span data-stu-id="14640-162">Creates a hunt group for each gateway.</span></span> <span data-ttu-id="14640-163">L'identificatore pilota di ogni gruppo di risposta specifica il dial plan URI SIP di messaggistica unificata utilizzato dal pool Front end o dal server Standard Edition associato al gateway.</span><span class="sxs-lookup"><span data-stu-id="14640-163">The pilot identifier of each hunt group specifies the UM SIP URI dial plan used by the Front End pool or Standard Edition server that is associated with the gateway.</span></span>
    - <span data-ttu-id="14640-164">Concede l'autorizzazione di Skype for Business Server alla lettura degli oggetti di messaggistica unificata di Exchange in servizi di dominio Active Directory.</span><span class="sxs-lookup"><span data-stu-id="14640-164">Grants Skype for Business Server permission to read Exchange UM objects in Active Directory Domain Services.</span></span>



### <a name="configure-unified-messaging-on-microsoft-exchange-with-exchucutilps1"></a><span data-ttu-id="14640-165">Configurare la messaggistica unificata in Microsoft Exchange con ExchUCUtil.ps1</span><span class="sxs-lookup"><span data-stu-id="14640-165">Configure Unified Messaging on Microsoft Exchange with ExchUCUtil.ps1</span></span> 

<span data-ttu-id="14640-166">Quando si sta integrando Microsoft Skype for Business Server con la messaggistica unificata di Exchange, è necessario eseguire lo script ExchUcUtil.ps1 in Shell.</span><span class="sxs-lookup"><span data-stu-id="14640-166">When you’re integrating Microsoft Skype for Business Server with Exchange Unified Messaging (UM), you have to run the ExchUcUtil.ps1 script in the Shell.</span></span> <span data-ttu-id="14640-167">Lo script ExchUcUtil.ps1 esegue quanto indicato di seguito:</span><span class="sxs-lookup"><span data-stu-id="14640-167">The ExchUcUtil.ps1 script does the following:</span></span>

- <span data-ttu-id="14640-168">Crea un gateway IP di messaggistica unificata per ogni pool di Skype for Business Server.</span><span class="sxs-lookup"><span data-stu-id="14640-168">Creates a UM IP gateway for each Skype for Business Server pool.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="14640-169">Lo script ExchUcUtil.ps1 crea uno o più gateway IP di messaggistica unificata.</span><span class="sxs-lookup"><span data-stu-id="14640-169">The ExchUcUtil.ps1 script creates one or more UM IP gateways.</span></span> <span data-ttu-id="14640-170">È necessario disabilitare le chiamate in uscita su tutti i gateway IP di messaggistica unificata, ad eccezione di quello creato dallo script.</span><span class="sxs-lookup"><span data-stu-id="14640-170">You must disable outgoing calls on all UM IP gateways except one gateway that the script created.</span></span> <span data-ttu-id="14640-171">Questo comprende la disabilitazione delle chiamate in uscita sui gateway IP di messaggistica unificata creati prima dell'esecuzione dello script.</span><span class="sxs-lookup"><span data-stu-id="14640-171">This includes disabling outgoing calls on UM IP gateways that were created before you ran the script.</span></span> 

- <span data-ttu-id="14640-172">Crea un gruppo di risposta di messaggistica unificata per ciascun gateway IP di messaggistica unificata.</span><span class="sxs-lookup"><span data-stu-id="14640-172">Creates a UM hunt group for each UM IP gateway.</span></span> <span data-ttu-id="14640-173">L'identificatore pilota di ogni gruppo di risposta specifica il dial plan di messaggistica unificata URI SIP utilizzato dal pool Front End di Skype for Business Server o dal server Standard Edition associato al gateway IP di messaggistica unificata.</span><span class="sxs-lookup"><span data-stu-id="14640-173">The pilot identifier of each hunt group specifies the UM SIP URI dial plan used by the Skype for Business Server Front End pool or Standard Edition server that’s associated with the UM IP gateway.</span></span>
- <span data-ttu-id="14640-174">Concede l'autorizzazione di Skype for Business Server alla lettura di oggetti contenitore di messaggistica unificata di Active Directory, ad esempio dial plan, operatori automatici, gateway IP di messaggistica unificata e gruppi di risposta di messaggistica unificata.</span><span class="sxs-lookup"><span data-stu-id="14640-174">Grants Skype for Business Server permission to read Active Directory UM container objects such as UM dial plans, auto attendants, UM IP gateways, and UM hunt groups.</span></span>
  > [!IMPORTANT]
  > <span data-ttu-id="14640-175">Ogni foresta di messaggistica unificata deve essere configurata per considerare attendibile la foresta in cui è distribuito Skype for Business Server e la foresta in cui è distribuito Skype for Business Server 2013 deve essere configurata in modo da considerare attendibile ogni foresta di messaggistica unificata.</span><span class="sxs-lookup"><span data-stu-id="14640-175">Each UM forest must be configured to trust the forest in which Skype for Business Server is deployed, and the forest in which Skype for Business Server 2013 is deployed must be configured to trust each UM forest.</span></span> <span data-ttu-id="14640-176">Se la messaggistica unificata di Exchange è installata in più foreste, è necessario eseguire la procedura di integrazione di Exchange Server per ogni foresta di messaggistica unificata oppure è necessario specificare il dominio Skype for Business Server.</span><span class="sxs-lookup"><span data-stu-id="14640-176">If Exchange UM is installed in multiple forests, the Exchange Server integration steps must be performed for each UM forest or you’ll have to specify the Skype for Business Server domain.</span></span> <span data-ttu-id="14640-177">Ad esempio, ExchUcUtil.ps1-Forest: <Lync-domain-controller-FQDN>.</span><span class="sxs-lookup"><span data-stu-id="14640-177">For example, ExchUcUtil.ps1 –Forest:<lync-domain-controller-fqdn>.</span></span> 

### <a name="use-the-shell-to-run-the-exchucutilps1-script"></a><span data-ttu-id="14640-178">Utilizzo di Shell per l'esecuzione dello script ExchUcUtil.ps1</span><span class="sxs-lookup"><span data-stu-id="14640-178">Use the Shell to run the ExchUcUtil.ps1 script</span></span>

<span data-ttu-id="14640-179">Eseguire lo script ExchUcUtil.ps1 su qualsiasi server Exchange dell'organizzazione che si trova nella stessa topologia di Skype for Business Server.</span><span class="sxs-lookup"><span data-stu-id="14640-179">Run the ExchUcUtil.ps1 script on any Exchange server in your organization that’s in the same topology as Skype for Business Server.</span></span> <span data-ttu-id="14640-180">È possibile eseguire lo script da un server Cassette postali utilizzando Shell oppure utilizzando Windows PowerShell remoto su un server Accesso client.</span><span class="sxs-lookup"><span data-stu-id="14640-180">You can run the script from a Mailbox server using the Shell or you can run the script using Remote Windows PowerShell on a Client Access server.</span></span> <span data-ttu-id="14640-181">Se si esegue lo script su un server Accesso client dell'organizzazione, tale server inoltrerà la sessione di Windows PowerShell remoto a un server Cassette postali dell'organizzazione.</span><span class="sxs-lookup"><span data-stu-id="14640-181">If you run the script on a Client Access server in your organization, the Client Access server will proxy the Remote Windows PowerShell session to a Mailbox server in the organization.</span></span>
> [!IMPORTANT]
> <span data-ttu-id="14640-182">Lo script ExchUcUtil.ps1 crea uno o più gateway IP di messaggistica unificata.</span><span class="sxs-lookup"><span data-stu-id="14640-182">The ExchUcUtil.ps1 script creates one or more UM IP gateways.</span></span> <span data-ttu-id="14640-183">È necessario disabilitare le chiamate in uscita su tutti i gateway IP di messaggistica unificata, ad eccezione di quello creato dallo script.</span><span class="sxs-lookup"><span data-stu-id="14640-183">You must disable outgoing calls on all UM IP gateways except one gateway that the script created.</span></span> <span data-ttu-id="14640-184">Questo comprende la disabilitazione delle chiamate in uscita sui gateway IP di messaggistica unificata creati prima dell'esecuzione dello script.</span><span class="sxs-lookup"><span data-stu-id="14640-184">This includes disabling outgoing calls on UM IP gateways that were created before you ran the script.</span></span> <span data-ttu-id="14640-185">Per disabilitare le chiamate in uscita su un gateway IP di messaggistica unificata, vedere Disabilitare le chiamate in uscita sui gateway IP di messaggistica unificata.</span><span class="sxs-lookup"><span data-stu-id="14640-185">To disable outgoing calls on a UM IP gateway, see Disable outgoing calls on UM IP gateways.</span></span> 
> [!IMPORTANT]
> <span data-ttu-id="14640-186">Per eseguire lo script, è necessario disporre delle autorizzazioni del ruolo Exchange Organization Management o essere membri del gruppo di sicurezza Exchange Organization Administrators.</span><span class="sxs-lookup"><span data-stu-id="14640-186">You must have the permissions of the Exchange Organization Management role or be a member of the Exchange Organization Administrators security group to run the script.</span></span> 

1. <span data-ttu-id="14640-187">Aprire Exchange Management Shell.</span><span class="sxs-lookup"><span data-stu-id="14640-187">Open the Exchange Management Shell.</span></span>
2. <span data-ttu-id="14640-188">Al prompt di C:\Windows\System32 digitare **CD \<drive letter> : \Program c:\Programmi\Microsoft\Exchange Server\V15\Scripts # C0.ExchUcUtil.ps1** e quindi premere INVIO.</span><span class="sxs-lookup"><span data-stu-id="14640-188">At the C:\Windows\System32 prompt, type **cd \<drive letter>:\Program Files\Microsoft\Exchange Server\V15\Scripts>.ExchUcUtil.ps1**, and then press Enter.</span></span>

#### <a name="how-do-you-know-this-worked"></a><span data-ttu-id="14640-189">Verifica dell'esito positivo dell'operazione</span><span class="sxs-lookup"><span data-stu-id="14640-189">How do you know this worked?</span></span>

<span data-ttu-id="14640-190">Per verificare che lo script ExchUcUtul.ps1 sia stato eseguito correttamente, procedere come segue:</span><span class="sxs-lookup"><span data-stu-id="14640-190">To verify that the ExchUcUtul.ps1 script completed successfully, do the following:</span></span>
- <span data-ttu-id="14640-191">Utilizzare il cmdlet Get-UMIPGateway o l'interfaccia di amministrazione di Exchange per visualizzare il nuovo gateway IP di messaggistica unificata o i gateway che sono stati creati.</span><span class="sxs-lookup"><span data-stu-id="14640-191">Use the Get-UMIPGateway cmdlet or the EAC to view the new UM IP gateway or gateways that were created.</span></span>
- <span data-ttu-id="14640-192">Utilizzare il cmdlet Get-UMHuntGroup o l'interfaccia di amministrazione di Exchange per visualizzare il nuovo gruppo di risposta di messaggistica unificata o i gruppi che sono stati creati.</span><span class="sxs-lookup"><span data-stu-id="14640-192">Use the Get-UMHuntGroup cmdlet or the EAC to view the new UM hunt group or groups that were created.</span></span>

### <a name="configure-certificates-on-the-server-running-exchange-server-unified-messaging"></a><span data-ttu-id="14640-193">Configurare i certificati nel server che esegue la messaggistica unificata di Exchange Server</span><span class="sxs-lookup"><span data-stu-id="14640-193">Configure certificates on the server running Exchange Server Unified Messaging</span></span>
 
<span data-ttu-id="14640-194">Se la messaggistica unificata di Exchange è stata distribuita, come descritto in pianificazione dell'integrazione della messaggistica unificata di Exchange in Skype for Business Server nella documentazione relativa alla pianificazione e si desidera fornire le funzionalità di messaggistica unificata di Exchange agli utenti di VoIP aziendale nell'organizzazione, è possibile utilizzare le procedure seguenti per configurare il certificato sul server che esegue la messaggistica unificata di Exchange.</span><span class="sxs-lookup"><span data-stu-id="14640-194">If you have deployed Exchange Unified Messaging (UM), as described in Planning for Exchange Unified Messaging integration in Skype for Business Server in the Planning documentation, and you want to provide Exchange UM features to Enterprise Voice users in your organization, you can use the following procedures to configure the certificate on the server running Exchange UM.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="14640-195">Per i certificati interni, entrambi i server che eseguono Skype for Business Server e i server che eseguono Microsoft Exchange devono disporre di certificati attendibili per l'autorità radice che sono mutuamente attendibili.</span><span class="sxs-lookup"><span data-stu-id="14640-195">For internal certificates, both the servers running Skype for Business Server and the servers running Microsoft Exchange must have trusted root authority certificates that are mutually trusted.</span></span> <span data-ttu-id="14640-196">L'autorità di certificazione (CA) può essere la stessa o un'autorità di certificazione diversa, purché i server dispongano del certificato radice dell'autorità di certificazione registrata nell'archivio certificati dell'autorità radice attendibile.</span><span class="sxs-lookup"><span data-stu-id="14640-196">The certification authority (CA) can either be the same, or a different certification authority, as long as the servers have the certification authority’s root certificate registered in their trusted root authority certificate store.</span></span> 

<span data-ttu-id="14640-197">Il server di Exchange deve essere configurato con un certificato del server per connettersi a Skype for Business Server:</span><span class="sxs-lookup"><span data-stu-id="14640-197">The Exchange Server must be configured with a server certificate in order to connect to Skype for Business Server:</span></span>
1. <span data-ttu-id="14640-198">Scaricare il certificato CA per Exchange Server.</span><span class="sxs-lookup"><span data-stu-id="14640-198">Download the CA certificate for the Exchange Server.</span></span>
2. <span data-ttu-id="14640-199">Installare il certificato CA per Exchange Server.</span><span class="sxs-lookup"><span data-stu-id="14640-199">Install the CA certificate for the Exchange Server.</span></span>
3. <span data-ttu-id="14640-200">Verificare che la CA sia inclusa nell'elenco delle CA radice attendibili di Exchange Server.</span><span class="sxs-lookup"><span data-stu-id="14640-200">Verify that the CA is in the list of trusted root CAs of the Exchange Server.</span></span>
4. <span data-ttu-id="14640-201">Creare una richiesta di certificato per Exchange Server e installare il certificato.</span><span class="sxs-lookup"><span data-stu-id="14640-201">Create a certificate request for the Exchange Server and install the certificate.</span></span> 
5. <span data-ttu-id="14640-202">Assegnare il certificato per Exchange Server.</span><span class="sxs-lookup"><span data-stu-id="14640-202">Assign the certificate for the Exchange Server.</span></span>


<span data-ttu-id="14640-203">**Per scaricare il certificato CA:**</span><span class="sxs-lookup"><span data-stu-id="14640-203">**To download the CA certificate:**</span></span>

1. <span data-ttu-id="14640-204">Nel server che esegue la messaggistica unificata di Exchange, fare clic sul pulsante **Start**, scegliere **esegui**, digitare **http:// \<name of your Issuing CA Server> /certsrv** e quindi fare clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="14640-204">On the server running Exchange UM, click **Start**, click **Run**, type **http://\<name of your Issuing CA Server>/certsrv**, and then click **OK**.</span></span>
2. <span data-ttu-id="14640-205">In selezionare un'attività fare clic su **Scarica un certificato CA, la catena di certificati o un CRL**.</span><span class="sxs-lookup"><span data-stu-id="14640-205">Under Select a task, click **Download a CA certificate, certificate chain, or CRL**.</span></span>
3. <span data-ttu-id="14640-206">In **Scarica un certificato CA, una catena di certificati o un CRL selezionare il** **metodo di codifica su base 64** e quindi fare clic su **Scarica certificato CA**.</span><span class="sxs-lookup"><span data-stu-id="14640-206">Under **Download a CA Certificate, Certificate Chain, or CRL**, select **Encoding Method to Base 64**, and then click **Download CA certificate**.</span></span>
   > [!NOTE]
   > <span data-ttu-id="14640-207">È inoltre possibile specificare la codifica DER (Distinguished Encoding Rules) in questo passaggio.</span><span class="sxs-lookup"><span data-stu-id="14640-207">You can also specify Distinguished Encoding Rules (DER) encoding at this step.</span></span> <span data-ttu-id="14640-208">Se si seleziona la codifica DER, il tipo di file nel prossimo passaggio e nel passaggio 10 di **Per installare il certificato CA** è .p7b anziché .cer.</span><span class="sxs-lookup"><span data-stu-id="14640-208">If you select DER encoding, the file type in the next step of this procedure and in step 10 of **To Install the CA certificate** is .p7b rather than .cer.</span></span> 
4. <span data-ttu-id="14640-p123">Nella finestra di dialogo **Download file** fare clic su **Salva** e quindi salvare il file nel disco rigido del server. Il file avrà estensione cer o p7b, a seconda della codifica selezionata nel passaggio precedente.</span><span class="sxs-lookup"><span data-stu-id="14640-p123">In the **File Download** dialog box, click **Save**, and then save the file to the hard disk on the server. (The file will have either a .cer or a .p7b file extension, depending on the encoding that you selected in the previous step.)</span></span>

<span data-ttu-id="14640-211">**Per installare il certificato CA:**</span><span class="sxs-lookup"><span data-stu-id="14640-211">**To install the CA certificate:**</span></span>

1. <span data-ttu-id="14640-212">Nel server che esegue la messaggistica unificata di Exchange, aprire Microsoft Management Console (MMC) facendo clic sul pulsante **Start**, scegliendo **Esegui**, digitando **MMC** nella casella Apri e quindi facendo clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="14640-212">On the server running Exchange UM, open Microsoft Management Console (MMC) by clicking **Start**, clicking **Run**, typing **mmc** in the Open box, and then clicking **OK**.</span></span>
2. <span data-ttu-id="14640-213">Scegliere **Aggiungi/Rimuovi snap-in** dal menu **File** e quindi fare clic su **Aggiungi**.</span><span class="sxs-lookup"><span data-stu-id="14640-213">On the **File** menu, click **Add/Remove Snap-in**, and then click **Add**.</span></span>
3. <span data-ttu-id="14640-214">Nella casella **Aggiungi snap-in autonomo** fare clic su **Certificati** e quindi su **Aggiungi**.</span><span class="sxs-lookup"><span data-stu-id="14640-214">In the **Add Standalone Snap-ins** box, click **Certificates**, and then click **Add**.</span></span>
4. <span data-ttu-id="14640-215">Nella finestra di dialogo **Snap-in certificati** fare clic su **Account del computer** e quindi su **Avanti**.</span><span class="sxs-lookup"><span data-stu-id="14640-215">In the **Certificate snap-in** dialog box, click **Computer account**, and then click **Next**.</span></span>
5. <span data-ttu-id="14640-216">Nella finestra di dialogo **Seleziona computer** verificare che sia selezionata la casella di controllo computer **locale (il computer su cui è in esecuzione questa console)** e quindi fare clic su **fine**.</span><span class="sxs-lookup"><span data-stu-id="14640-216">In the **Select Computer** dialog box, verify that the **Local computer: (the computer this console is running on)** check box is selected, and then click **Finish**.</span></span>
6. <span data-ttu-id="14640-217">Fare clic su **Chiudi** e quindi su **OK**.</span><span class="sxs-lookup"><span data-stu-id="14640-217">Click **Close**, and then click **OK**.</span></span> 
7. <span data-ttu-id="14640-218">Nell'albero della console espandere **Certificati (computer locale)**, espandere **Autorità di certificazione radice attendibili** e quindi fare clic su **Certificati**.</span><span class="sxs-lookup"><span data-stu-id="14640-218">In the console tree, expand **Certificates (Local Computer)**, expand **Trusted Root Certification Authorities**, and then click **Certificates**.</span></span>
8. <span data-ttu-id="14640-219">Fare clic con il pulsante destro del mouse su **Certificati**, scegliere **Tutte le attività** e quindi **Importa**.</span><span class="sxs-lookup"><span data-stu-id="14640-219">Right-click **Certificates**, click **All Tasks**, and click **Import**.</span></span>
9. <span data-ttu-id="14640-220">Fare clic su **Avanti**.</span><span class="sxs-lookup"><span data-stu-id="14640-220">Click **Next**.</span></span> 
10. <span data-ttu-id="14640-p124">Fare clic su **Sfoglia** per individuare il file e quindi fare clic su **Avanti**. Il file avrà estensione cer o p7b, a seconda della codifica selezionata nel passaggio 3 di **Per scaricare il certificato CA**.</span><span class="sxs-lookup"><span data-stu-id="14640-p124">Click **Browse** to locate the file, and then click **Next**. (The file will have either a .cer or a .p7b file extension, depending on the encoding that you selected in step 3 of **To download the CA certificate**.</span></span>
11. <span data-ttu-id="14640-223">Fare clic su **colloca tutti i certificati** nel seguente archivio.</span><span class="sxs-lookup"><span data-stu-id="14640-223">Click **Place All Certificates** in the following store.</span></span>
12. <span data-ttu-id="14640-224">Fare clic su **Sfoglia** e quindi selezionare **Autorità di certificazione radice attendibili**.</span><span class="sxs-lookup"><span data-stu-id="14640-224">Click **Browse**, and then select **Trusted Root Certification Authorities**.</span></span> 
13. <span data-ttu-id="14640-225">Fare clic su **Avanti** per verificare le impostazioni e quindi fare clic su **Fine**.</span><span class="sxs-lookup"><span data-stu-id="14640-225">Click **Next** to verify the settings, and then click **Finish**.</span></span> 


<span data-ttu-id="14640-226">**Per verificare che l'autorità di certificazione sia presente nell'elenco delle autorità di certificazione radice attendibili:**</span><span class="sxs-lookup"><span data-stu-id="14640-226">**To verify that the CA is in the list of trusted root CAs:**</span></span>

1. <span data-ttu-id="14640-227">Nel server che esegue la messaggistica unificata di Exchange, in MMC espandere certificati (computer locale), espandere Autorità di certificazione radice attendibili e quindi fare clic su certificati.</span><span class="sxs-lookup"><span data-stu-id="14640-227">On the server running Exchange UM, in MMC expand Certificates (Local Computer), expand Trusted Root Certification Authorities, and then click Certificates.</span></span>
2. <span data-ttu-id="14640-228">Nel riquadro dei dettagli verificare che la CA sia inclusa nell'elenco delle CA attendibili.</span><span class="sxs-lookup"><span data-stu-id="14640-228">In the details pane, verify that your CA is on the list of trusted CAs.</span></span>


