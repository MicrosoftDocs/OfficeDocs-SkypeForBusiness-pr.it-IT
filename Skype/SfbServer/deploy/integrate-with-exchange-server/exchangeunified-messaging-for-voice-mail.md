---
title: Configurazione della messaggistica unificata di Exchange Server 2013 per la segreteria telefonica di Skype for Business Server 2015
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
manager: serdars
ms.date: 2/11/2019
audience: ITPro
ms.topic: get-started-article
ms.prod: skype-for-business-itpro
localization_priority: Normal
ms.collection: IT_Skype16
ms.assetid: 1be9c4f4-fd8e-4d64-9798-f8737b12e2ab
description: 'Riepilogo: configurare la messaggistica unificata di Exchange Server per Skype for Business Server Voice mail.'
ms.openlocfilehash: a1c83b4ec92e6e3b3d678d2d7e0a65f58fc9d6ce
ms.sourcegitcommit: ab47ff88f51a96aaf8bc99a6303e114d41ca5c2f
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 05/20/2019
ms.locfileid: "36188147"
---
# <a name="configure-exchange-server-unified-messaging-for-skype-for-business-server-voice-mail"></a><span data-ttu-id="fdecd-103">Configurazione della messaggistica unificata di Exchange Server 2013 per la segreteria telefonica di Skype for Business Server 2015</span><span class="sxs-lookup"><span data-stu-id="fdecd-103">Configure Exchange Server Unified Messaging for Skype for Business Server voice mail</span></span>
 
<span data-ttu-id="fdecd-104">**Riepilogo:** Configurare la messaggistica unificata di Exchange Server per Skype for Business Server Voice mail.</span><span class="sxs-lookup"><span data-stu-id="fdecd-104">**Summary:** Configure Exchange Server Unified Messaging for Skype for Business Server voice mail.</span></span>
  
<span data-ttu-id="fdecd-105">Skype for Business Server consente di archiviare i messaggi della segreteria telefonica in Exchange Server 2016 o Exchange Server 2013; i messaggi della segreteria telefonica verranno quindi visualizzati come messaggi di posta elettronica nelle cassette postali degli utenti.</span><span class="sxs-lookup"><span data-stu-id="fdecd-105">Skype for Business Server enables you to have voicemail messages stored in Exchange Server 2016 or Exchange Server 2013; those voicemail messages will then appear as email messages in your users' Inboxes.</span></span> 

> [!NOTE]
> <span data-ttu-id="fdecd-106">La messaggistica unificata di Exchange, come precedentemente nota, non è più disponibile in Exchange 2019, ma è comunque possibile usare il sistema telefonico per registrare i messaggi della segreteria telefonica e quindi abbandonare la registrazione nella cassetta postale di Exchange dell'utente.</span><span class="sxs-lookup"><span data-stu-id="fdecd-106">Exchange Unified Messaging as previously known is no longer available in Exchange 2019, but you can still use Phone System to record voicemail messages and then leave the recording in a user's Exchange mailbox.</span></span> <span data-ttu-id="fdecd-107">Per altre informazioni, vedere [pianificare il servizio di segreteria cloud](../../../sfbhybrid/hybrid/plan-cloud-voicemail.md) .</span><span class="sxs-lookup"><span data-stu-id="fdecd-107">See [Plan Cloud Voicemail service](../../../sfbhybrid/hybrid/plan-cloud-voicemail.md) for more information.</span></span>
  
<span data-ttu-id="fdecd-108">Se si è già configurata l'autenticazione da server a server tra Skype for Business Server e Exchange Server 2016 o Exchange Server 2013, si è pronti per configurare la messaggistica unificata.</span><span class="sxs-lookup"><span data-stu-id="fdecd-108">If you have already configured server-to-server authentication between Skype for Business Server and Exchange Server 2016 or Exchange Server 2013, then you are ready to setup unified messaging.</span></span> <span data-ttu-id="fdecd-109">A tale scopo, è necessario prima di tutto creare e assegnare un nuovo dial plan di messaggistica unificata nel server Exchange.</span><span class="sxs-lookup"><span data-stu-id="fdecd-109">To do so, you must first create and assign a new unified messaging dial plan on your Exchange Server.</span></span> <span data-ttu-id="fdecd-110">Ad esempio, questi due comandi (eseguiti da Exchange Management Shell) configurano un nuovo dial plan a 3 cifre per Exchange:</span><span class="sxs-lookup"><span data-stu-id="fdecd-110">For example, these two commands (run from within the Exchange Management Shell) configure a new 3-digit dial plan for Exchange:</span></span>
  
```
New-UMDialPlan -Name "RedmondDialPlan" -VoIPSecurity "Secured" -NumberOfDigitsInExtension 3 -URIType "SipName" -CountryOrRegionCode 1
Set-UMDialPlan "RedmondDialPlan" -ConfiguredInCountryOrRegionGroups "Anywhere,*,*,*" -AllowedInCountryOrRegionGroups "Anywhere"
```

<span data-ttu-id="fdecd-111">Nel primo comando dell'esempio, il parametro VoIPSecurity e il valore del parametro "Secured" indicano che il canale di segnalazione viene crittografato con Transport Layer Security (TLS).</span><span class="sxs-lookup"><span data-stu-id="fdecd-111">In the first command in the example, the VoIPSecurity parameter, and the parameter value "Secured" indicates that the signaling channel is encrypted by using Transport Layer Security (TLS).</span></span> <span data-ttu-id="fdecd-112">URIType "SipName" indica che i messaggi verranno inviati e ricevuti usando il protocollo SIP e il CountryOrRegionCode di 1 indica che il dial plan si applica agli Stati Uniti.</span><span class="sxs-lookup"><span data-stu-id="fdecd-112">The URIType "SipName" indicates that messages will be sent and received using the SIP protocol, and the CountryOrRegionCode of 1 indicates that the dial plan applies to the US.</span></span>
  
<span data-ttu-id="fdecd-113">Nel secondo comando, il valore del parametro passato al parametro ConfiguredInCountryOrRegionGroups specifica i gruppi in-Country che possono essere usati con questo dial plan.</span><span class="sxs-lookup"><span data-stu-id="fdecd-113">In the second command, the parameter value passed to the ConfiguredInCountryOrRegionGroups parameter specifies the in-country groups that can be used with this dial plan.</span></span> <span data-ttu-id="fdecd-114">Il valore del parametro "Anywhere\*,\*,\*," imposta le operazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="fdecd-114">The parameter value "Anywhere,\*,\*,\*" sets the following:</span></span>
  
- <span data-ttu-id="fdecd-115">Nome gruppo ("ovunque")</span><span class="sxs-lookup"><span data-stu-id="fdecd-115">Group name ("Anywhere")</span></span>
    
- <span data-ttu-id="fdecd-116">AllowedNumberString (\*, un carattere jolly che indica che è consentita una stringa di numero qualsiasi)</span><span class="sxs-lookup"><span data-stu-id="fdecd-116">AllowedNumberString (\*, a wildcard character indicating that any number string is allowed)</span></span>
    
- <span data-ttu-id="fdecd-117">DialNumberString (\*, un carattere jolly che indica che è consentito qualsiasi numero composto)</span><span class="sxs-lookup"><span data-stu-id="fdecd-117">DialNumberString (\*, a wildcard character indicating that any dialed number is allowed)</span></span>
    
- <span data-ttu-id="fdecd-118">TextComment (\*, un carattere jolly che indica che è consentito qualsiasi comando di testo)</span><span class="sxs-lookup"><span data-stu-id="fdecd-118">TextComment (\*, a wildcard character indicating that any text command is allowed)</span></span>
    
> [!NOTE]
> <span data-ttu-id="fdecd-119">La creazione di un nuovo dial plan creerà anche un criterio predefinito per le cassette postali.</span><span class="sxs-lookup"><span data-stu-id="fdecd-119">Creating a new dial plan will also create a Default Mailbox Policy.</span></span> 
  
<span data-ttu-id="fdecd-120">Dopo aver creato e configurato il nuovo piano di chiamata, è necessario aggiungere il nuovo dial plan al server Messaggistica unificata e quindi modificare la modalità di avvio del server. in particolare, devi impostare la modalità di avvio su "Dual".</span><span class="sxs-lookup"><span data-stu-id="fdecd-120">After creating and configuring the new dial plan you must add the new dial plan to your unified messaging server and then modify the startup mode of that server; in particular, you must set the startup mode to "Dual".</span></span> <span data-ttu-id="fdecd-121">È possibile eseguire entrambe le attività dall'interno di Exchange Management Shell:</span><span class="sxs-lookup"><span data-stu-id="fdecd-121">You can perform both of these tasks from within the Exchange Management Shell:</span></span>
  
```
Set-UmService -Identity "atl-exchangeum-001.litwareinc.com" -DialPlans "RedmondDialPlan" -UMStartupMode "Dual"
```

<span data-ttu-id="fdecd-122">Dopo aver configurato il server Messaggistica unificata, è consigliabile eseguire il cmdlet Enable-ExchangeCertificate per verificare che il certificato di Exchange venga applicato al servizio di messaggistica unificata:</span><span class="sxs-lookup"><span data-stu-id="fdecd-122">After the unified messaging server has been configured you should next run the Enable-ExchangeCertificate cmdlet to ensure that your Exchange certificate is applied to the unified messaging service:</span></span>
  
```
Enable-ExchangeCertificate -Server "atl-umserver-001.litwareinc.com" -Thumbprint "EA5A332496CC05DA69B75B66111C0F78A110D22d" -Services "SMTP","IIS","UM"
```

<span data-ttu-id="fdecd-123">Dopo che il certificato è stato assegnato correttamente, è necessario arrestare e riavviare il servizio MsExchangeum nel server Messaggistica unificata.</span><span class="sxs-lookup"><span data-stu-id="fdecd-123">After the certificate has been correctly assigned you must then stop and restart the MsExchangeUM service on the unified messaging server.</span></span> <span data-ttu-id="fdecd-124">Questo servizio deve essere interrotto e riavviato ogni volta che si modifica la modalità di avvio.</span><span class="sxs-lookup"><span data-stu-id="fdecd-124">This service must be stopped and restarted any time you change the startup mode.</span></span>
  
<span data-ttu-id="fdecd-125">Dopo aver terminato la configurazione del server Messaggistica unificata, è possibile configurare il router di chiamata di messaggistica unificata:</span><span class="sxs-lookup"><span data-stu-id="fdecd-125">After finishing configuration of the unified messaging server you can then configure the UM Call Router:</span></span>
  
```
Set-UMCallRouterSettings -Server "atl-exchange-001.litwareinc.com" -UMStartupMode "Dual" -DialPlans "RedmondDialPlan" 
Enable-ExchangeCertificate -Server "atl-umserver-001.litwareinc.com" -Thumbprint "45BAA32496CC891169B75B9811320F78A1075DDA" -Services "IIS","UMCallRouter"
```

<span data-ttu-id="fdecd-126">Poiché la modalità di avvio è cambiata, è necessario interrompere e riavviare il servizio MsExchangeUMCR nel computer che ospita il router di chiamata di messaggistica unificata.</span><span class="sxs-lookup"><span data-stu-id="fdecd-126">Because the startup mode has changed you must stop and restart the MsExchangeUMCR service on the computer hosting the UM Call Router.</span></span>
  
<span data-ttu-id="fdecd-127">Per completare la configurazione della messaggistica unificata, è necessario creare un criterio cassetta postale di messaggistica unificata e quindi usare questo criterio per consentire agli utenti la messaggistica unificata.</span><span class="sxs-lookup"><span data-stu-id="fdecd-127">To complete the unified messaging setup, you then need to create a UM mailbox policy and then use that policy to enable users for unified messaging.</span></span> <span data-ttu-id="fdecd-128">È possibile creare un criterio cassetta postale usando un comando simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="fdecd-128">You can create a mailbox policy by using a command similar to this:</span></span>
  
```
New-UMMailboxPolicy -Name "RedmondMailboxPolicy" -AllowedInCountryOrRegionGroups "Anywhere"
```

<span data-ttu-id="fdecd-129">Puoi abilitare un utente per la messaggistica unificata usando un comando simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="fdecd-129">And you can enable a user for unified messaging by using a command similar to this:</span></span>
  
```
Enable-UMMailbox -Extensions 100 -SIPResourceIdentifier "kenmyer@litwareinc.com" -Identity "litwareinc\kenmyer" -UMMailboxPolicy "RedmondMailboxPolicy"
```

<span data-ttu-id="fdecd-130">Nel comando precedente il parametro Extensions rappresenta il numero di interno telefonico per l'utente.</span><span class="sxs-lookup"><span data-stu-id="fdecd-130">In the preceding command, the Extensions parameter represents the telephone extension number for the user.</span></span> <span data-ttu-id="fdecd-131">In questo esempio l'utente ha il numero di interno 100.</span><span class="sxs-lookup"><span data-stu-id="fdecd-131">In this example, the user has the extension number 100.</span></span>
  
<span data-ttu-id="fdecd-132">Dopo aver abilitato la cassetta postale, l'utente kenmyer@litwareinc.com dovrebbe essere in grado di usare la messaggistica unificata di Exchange.</span><span class="sxs-lookup"><span data-stu-id="fdecd-132">After you have enabled his mailbox, the user kenmyer@litwareinc.com should be able to use Exchange unified messaging.</span></span> <span data-ttu-id="fdecd-133">Puoi verificare che l'utente possa connettersi alla messaggistica unificata di Exchange eseguendo il cmdlet [test-CsExUMConnectivity](https://docs.microsoft.com/powershell/module/skype/test-csexumconnectivity?view=skype-ps) da Skype for Business Server Management Shell:</span><span class="sxs-lookup"><span data-stu-id="fdecd-133">You can verify that the user can connect to Exchange UM by running the [Test-CsExUMConnectivity](https://docs.microsoft.com/powershell/module/skype/test-csexumconnectivity?view=skype-ps) cmdlet from within the Skype for Business Server Management Shell:</span></span>
  
```
$credential = Get-Credential "litwareinc\kenmyer"
Test-CsExUMConnectivity -TargetFqdn "atl-cs-001.litwareinc.com" -UserSipAddress "sip:kenmyer@litwareinc.com" -UserCredential $credential
```

<span data-ttu-id="fdecd-134">Se si ha un secondo utente abilitato per la messaggistica unificata, è possibile usare il cmdlet [test-CsExUMVoiceMail](https://docs.microsoft.com/powershell/module/skype/test-csexumvoicemail?view=skype-ps) per verificare che il secondo utente possa uscire da un messaggio della segreteria telefonica per il primo utente.</span><span class="sxs-lookup"><span data-stu-id="fdecd-134">If you have a second user who has been enabled for unified messaging you can use the [Test-CsExUMVoiceMail](https://docs.microsoft.com/powershell/module/skype/test-csexumvoicemail?view=skype-ps) cmdlet to verify that this second user can leave a voicemail message for the first user.</span></span>
  
```
$credential = Get-Credential "litwareinc\pilar"
Test-CsExUMVoiceMail -TargetFqdn "atl-cs-001.litwareinc.com" -ReceiverSipAddress "sip:kenmyer@litwareinc.com" -SenderSipAddress "sip:pilar@litwareinc.com" -SenderCredential $credential
```



## <a name="configuring-unified-messaging-on-microsoft-exchange-server"></a><span data-ttu-id="fdecd-135">Configurazione della messaggistica unificata in Microsoft Exchange Server</span><span class="sxs-lookup"><span data-stu-id="fdecd-135">Configuring Unified Messaging on Microsoft Exchange Server</span></span> 
> [!IMPORTANT]
> <span data-ttu-id="fdecd-136">Se si vuole usare la messaggistica unificata di Exchange (UM) per fornire risposte alle chiamate, Outlook Voice Access o servizi di operatore automatico per gli utenti di VoIP aziendale, leggere il [piano per l'integrazione della messaggistica unificata di Exchange in Skype for business](../../plan-your-deployment/integrate-with-exchange/unified-messaging.md)e quindi seguire le istruzioni in questa sezione.</span><span class="sxs-lookup"><span data-stu-id="fdecd-136">If you want to use Exchange Unified Messaging (UM) to provide call answering, Outlook Voice Access, or auto-attendant services for Enterprise Voice users, read [Plan for Exchange Unified Messaging integration in Skype for Business](../../plan-your-deployment/integrate-with-exchange/unified-messaging.md), and then follow the instructions in this section.</span></span> 

<span data-ttu-id="fdecd-137">Per configurare la messaggistica UNIFICAta di Exchange per l'utilizzo di Enterprise Voice, è necessario eseguire le attività seguenti:</span><span class="sxs-lookup"><span data-stu-id="fdecd-137">To configure Exchange Unified Messaging (UM) to work with Enterprise Voice, you’ll need to perform the following tasks:</span></span>

- <span data-ttu-id="fdecd-138">Configurare i certificati nel server che gestisce i servizi di messaggistica UNIFICAta di Exchange</span><span class="sxs-lookup"><span data-stu-id="fdecd-138">Configure certificates on the server running Exchange Unified Messaging (UM) services</span></span>
  > [!NOTE]
  > <span data-ttu-id="fdecd-139">Aggiungere tutti i server di accesso client e cassette postali a tutti i dial plan URI SIP di messaggistica unificata.</span><span class="sxs-lookup"><span data-stu-id="fdecd-139">Add all Client Access and Mailbox servers to all UM SIP URI dial plans.</span></span> <span data-ttu-id="fdecd-140">In caso contrario, il routing delle chiamate in uscita non funziona come previsto.</span><span class="sxs-lookup"><span data-stu-id="fdecd-140">If not, outbound call routing won’t work as expected.</span></span> 
- <span data-ttu-id="fdecd-141">Creare uno o più piani di dial URI SIP di messaggistica unificata, insieme ai numeri di telefono di accesso del Sottoscrittore, in base alle esigenze e quindi creare i dial plan di L corrispondenti.</span><span class="sxs-lookup"><span data-stu-id="fdecd-141">Create one or more UM SIP URI dial plans, along with the subscriber access phone numbers, as needed, and then create corresponding L dial plans.</span></span>

- <span data-ttu-id="fdecd-142">USA lo script exchucutil. ps1 per:</span><span class="sxs-lookup"><span data-stu-id="fdecd-142">Use the exchucutil.ps1 script to:</span></span>
    - <span data-ttu-id="fdecd-143">Creare gateway IP di messaggistica unificata.</span><span class="sxs-lookup"><span data-stu-id="fdecd-143">Create UM IP gateways.</span></span>
    - <span data-ttu-id="fdecd-144">Creare gruppi di risposta di messaggistica unificata.</span><span class="sxs-lookup"><span data-stu-id="fdecd-144">Create UM hunt groups.</span></span>
    - <span data-ttu-id="fdecd-145">Concedere l'autorizzazione Skype for Business Server per la lettura degli oggetti servizi di dominio Active Directory di messaggistica unificata.</span><span class="sxs-lookup"><span data-stu-id="fdecd-145">Grant Skype for Business Server permission to read UM Active Directory Domain Services objects.</span></span>
- <span data-ttu-id="fdecd-146">Creare un oggetto operatore automatico di messaggistica unificata.</span><span class="sxs-lookup"><span data-stu-id="fdecd-146">Create a UM auto-attendant object.</span></span>
- <span data-ttu-id="fdecd-147">Creare un oggetto di accesso del Sottoscrittore.</span><span class="sxs-lookup"><span data-stu-id="fdecd-147">Create a subscriber access object.</span></span>
- <span data-ttu-id="fdecd-148">Crea un URI SIP per ogni utente e associa gli utenti a un dial plan di URI SIP di messaggistica unificata.</span><span class="sxs-lookup"><span data-stu-id="fdecd-148">Create a SIP URI for each user and associating users with a UM SIP URI dial plan.</span></span>

### <a name="requirements-and-recommendations"></a><span data-ttu-id="fdecd-149">Requisiti e suggerimenti</span><span class="sxs-lookup"><span data-stu-id="fdecd-149">Requirements and Recommendations</span></span>

<span data-ttu-id="fdecd-150">Prima di iniziare, la documentazione in questa sezione presuppone che siano stati distribuiti i ruoli di Exchange seguenti: accesso client e cassetta postale.</span><span class="sxs-lookup"><span data-stu-id="fdecd-150">Before you begin, the documentation in this section assumes that you have deployed the following Exchange roles: Client Access and Mailbox.</span></span> <span data-ttu-id="fdecd-151">In Microsoft Exchange Server la messaggistica unificata di Exchange viene eseguita come servizio in questi server.</span><span class="sxs-lookup"><span data-stu-id="fdecd-151">In Microsoft Exchange Server, Exchange UM runs as a service on these servers.</span></span>

<span data-ttu-id="fdecd-152">Tenere inoltre presente quanto segue:</span><span class="sxs-lookup"><span data-stu-id="fdecd-152">Also note the following:</span></span>
- <span data-ttu-id="fdecd-153">Se la messaggistica unificata di Exchange è installata in più foreste, è necessario eseguire la procedura di integrazione di Exchange Server per ogni foresta di messaggistica unificata.</span><span class="sxs-lookup"><span data-stu-id="fdecd-153">If Exchange UM is installed in multiple forests, the Exchange Server integration steps must be performed for each UM forest.</span></span> <span data-ttu-id="fdecd-154">Ogni foresta di messaggistica unificata deve inoltre essere configurata in modo da considerare attendibile la foresta in cui è distribuito Skype for Business Server e la distribuzione della foresta in whichSkype for Business Server deve essere configurata in modo da considerare attendibile ogni foresta di messaggistica unificata.</span><span class="sxs-lookup"><span data-stu-id="fdecd-154">In addition, each UM forest must be configured to trust the forest in which Skype for Business Server is deployed, and the forest in whichSkype for Business Server is deployed must be configured to trust each UM forest.</span></span>
- <span data-ttu-id="fdecd-155">I passaggi di integrazione vengono eseguiti nei ruoli del server Exchange in cui sono in esecuzione i servizi di messaggistica unificata e nel server che esegue Skype for Business Server.</span><span class="sxs-lookup"><span data-stu-id="fdecd-155">Integration steps are performed on both the Exchange Server roles where Unified Messaging services are running, and on the server running Skype for Business Server.</span></span> <span data-ttu-id="fdecd-156">È consigliabile eseguire i passaggi di integrazione della messaggistica unificata di Exchange Server prima di eseguire i passaggi di integrazione di Lync Server 2013.</span><span class="sxs-lookup"><span data-stu-id="fdecd-156">You should perform the Exchange Server Unified Messaging integration steps before you perform the Lync Server 2013 integration steps.</span></span>
  > [!NOTE]
  > <span data-ttu-id="fdecd-157">Per scoprire quali passaggi di integrazione vengono eseguiti in quali server e per quali ruoli di amministratore, vedere [Panoramica del processo di distribuzione per l'integrazione della messaggistica unificata locale e Skype for business](../../plan-your-deployment/integrate-with-exchange/deployment-overview.md).</span><span class="sxs-lookup"><span data-stu-id="fdecd-157">To see which integration steps are performed on which servers and by which administrator roles, see  [Deployment process overview for integrating on-premises Unified Messaging and Skype for Business](../../plan-your-deployment/integrate-with-exchange/deployment-overview.md).</span></span> 

<span data-ttu-id="fdecd-158">Gli strumenti seguenti devono essere disponibili in ogni server che gestisce la messaggistica unificata di Exchange:</span><span class="sxs-lookup"><span data-stu-id="fdecd-158">The following tools must be available on each server running Exchange UM:</span></span>
- <span data-ttu-id="fdecd-159">Exchange Management Shell</span><span class="sxs-lookup"><span data-stu-id="fdecd-159">Exchange Management Shell</span></span>
- <span data-ttu-id="fdecd-160">Lo script exchucutil. ps1, che esegue le attività seguenti:</span><span class="sxs-lookup"><span data-stu-id="fdecd-160">The script exchucutil.ps1, which performs the following tasks:</span></span>
    - <span data-ttu-id="fdecd-161">Crea un gateway IP di messaggistica unificata per ogni server Skype for business.</span><span class="sxs-lookup"><span data-stu-id="fdecd-161">Creates a UM IP gateway for each Skype for Business Server.</span></span>
    - <span data-ttu-id="fdecd-162">Crea un gruppo di ricerca per ogni gateway.</span><span class="sxs-lookup"><span data-stu-id="fdecd-162">Creates a hunt group for each gateway.</span></span> <span data-ttu-id="fdecd-163">L'identificatore pilota di ogni gruppo di ricerca specifica il dial plan URI SIP di messaggistica unificata usato dal pool Front-end o dal server Standard Edition associato al gateway.</span><span class="sxs-lookup"><span data-stu-id="fdecd-163">The pilot identifier of each hunt group specifies the UM SIP URI dial plan used by the Front End pool or Standard Edition server that is associated with the gateway.</span></span>
    - <span data-ttu-id="fdecd-164">Concede l'autorizzazione di Skype for Business Server per la lettura degli oggetti della messaggistica unificata di Exchange in servizi di dominio Active Directory.</span><span class="sxs-lookup"><span data-stu-id="fdecd-164">Grants Skype for Business Server permission to read Exchange UM objects in Active Directory Domain Services.</span></span>



### <a name="configure-unified-messaging-on-microsoft-exchange-with-exchucutilps1"></a><span data-ttu-id="fdecd-165">Configurare la messaggistica unificata in Microsoft Exchange con ExchUCUtil. ps1</span><span class="sxs-lookup"><span data-stu-id="fdecd-165">Configure Unified Messaging on Microsoft Exchange with ExchUCUtil.ps1</span></span> 

<span data-ttu-id="fdecd-166">Quando si integra Microsoft Skype for Business Server con la messaggistica UNIFICAta di Exchange, è necessario eseguire lo script ExchUcUtil. ps1 nella shell.</span><span class="sxs-lookup"><span data-stu-id="fdecd-166">When you’re integrating Microsoft Skype for Business Server with Exchange Unified Messaging (UM), you have to run the ExchUcUtil.ps1 script in the Shell.</span></span> <span data-ttu-id="fdecd-167">Lo script ExchUcUtil. ps1 esegue le operazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="fdecd-167">The ExchUcUtil.ps1 script does the following:</span></span>

- <span data-ttu-id="fdecd-168">Crea un gateway IP di messaggistica unificata per ogni pool di Skype for Business Server.</span><span class="sxs-lookup"><span data-stu-id="fdecd-168">Creates a UM IP gateway for each Skype for Business Server pool.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="fdecd-169">Lo script ExchUcUtil. ps1 crea uno o più gateway IP di messaggistica unificata.</span><span class="sxs-lookup"><span data-stu-id="fdecd-169">The ExchUcUtil.ps1 script creates one or more UM IP gateways.</span></span> <span data-ttu-id="fdecd-170">È necessario disabilitare le chiamate in uscita in tutti i gateway IP di messaggistica unificata eccetto un gateway creato dallo script.</span><span class="sxs-lookup"><span data-stu-id="fdecd-170">You must disable outgoing calls on all UM IP gateways except one gateway that the script created.</span></span> <span data-ttu-id="fdecd-171">Questo include la disabilitazione delle chiamate in uscita sui gateway IP di messaggistica unificata creati prima dell'esecuzione dello script.</span><span class="sxs-lookup"><span data-stu-id="fdecd-171">This includes disabling outgoing calls on UM IP gateways that were created before you ran the script.</span></span> 

- <span data-ttu-id="fdecd-172">Crea un gruppo di risposta di messaggistica unificata per ogni gateway IP di messaggistica unificata.</span><span class="sxs-lookup"><span data-stu-id="fdecd-172">Creates a UM hunt group for each UM IP gateway.</span></span> <span data-ttu-id="fdecd-173">L'identificatore pilota di ogni gruppo di ricerca specifica il dial plan di URI SIP di messaggistica unificata usato dal pool di front end di Skype for Business Server o dal server Standard Edition associato al gateway IP di messaggistica unificata.</span><span class="sxs-lookup"><span data-stu-id="fdecd-173">The pilot identifier of each hunt group specifies the UM SIP URI dial plan used by the Skype for Business Server Front End pool or Standard Edition server that’s associated with the UM IP gateway.</span></span>
- <span data-ttu-id="fdecd-174">Concede l'autorizzazione di Skype for Business Server per leggere gli oggetti contenitore di messaggistica unificata di Active Directory, ad esempio i dial plan di messaggistica unificata, gli operatori automatici, i gateway IP di messaggistica unificata e i gruppi di</span><span class="sxs-lookup"><span data-stu-id="fdecd-174">Grants Skype for Business Server permission to read Active Directory UM container objects such as UM dial plans, auto attendants, UM IP gateways, and UM hunt groups.</span></span>
  > [!IMPORTANT]
  > <span data-ttu-id="fdecd-175">Ogni foresta di messaggistica unificata deve essere configurata per considerare attendibile la foresta in cui è distribuito Skype for Business Server e la foresta in cui è installato Skype for Business Server 2013 deve essere configurata per considerare attendibile ogni foresta di messaggistica unificata.</span><span class="sxs-lookup"><span data-stu-id="fdecd-175">Each UM forest must be configured to trust the forest in which Skype for Business Server is deployed, and the forest in which Skype for Business Server 2013 is deployed must be configured to trust each UM forest.</span></span> <span data-ttu-id="fdecd-176">Se la messaggistica unificata di Exchange è installata in più foreste, è necessario eseguire la procedura di integrazione di Exchange Server per ogni foresta di messaggistica unificata oppure è necessario specificare il dominio di Skype for Business Server.</span><span class="sxs-lookup"><span data-stu-id="fdecd-176">If Exchange UM is installed in multiple forests, the Exchange Server integration steps must be performed for each UM forest or you’ll have to specify the Skype for Business Server domain.</span></span> <span data-ttu-id="fdecd-177">Ad esempio, ExchUcUtil. ps1-Forest: <Lync-domain-controller-FQDN>.</span><span class="sxs-lookup"><span data-stu-id="fdecd-177">For example, ExchUcUtil.ps1 –Forest:<lync-domain-controller-fqdn>.</span></span> 

### <a name="use-the-shell-to-run-the-exchucutilps1-script"></a><span data-ttu-id="fdecd-178">Usare la Shell per eseguire lo script ExchUcUtil. ps1</span><span class="sxs-lookup"><span data-stu-id="fdecd-178">Use the Shell to run the ExchUcUtil.ps1 script</span></span>

<span data-ttu-id="fdecd-179">Eseguire lo script ExchUcUtil. ps1 in qualsiasi server Exchange dell'organizzazione nella stessa topologia di Skype for Business Server.</span><span class="sxs-lookup"><span data-stu-id="fdecd-179">Run the ExchUcUtil.ps1 script on any Exchange server in your organization that’s in the same topology as Skype for Business Server.</span></span> <span data-ttu-id="fdecd-180">Puoi eseguire lo script da un server di cassette postali usando la Shell oppure puoi eseguire lo script usando Windows PowerShell remoto su un server Accesso client.</span><span class="sxs-lookup"><span data-stu-id="fdecd-180">You can run the script from a Mailbox server using the Shell or you can run the script using Remote Windows PowerShell on a Client Access server.</span></span> <span data-ttu-id="fdecd-181">Se si esegue lo script in un server Accesso client dell'organizzazione, il server Accesso client delega la sessione remota di Windows PowerShell a un server di cassette postali dell'organizzazione.</span><span class="sxs-lookup"><span data-stu-id="fdecd-181">If you run the script on a Client Access server in your organization, the Client Access server will proxy the Remote Windows PowerShell session to a Mailbox server in the organization.</span></span>
> [!IMPORTANT]
> <span data-ttu-id="fdecd-182">Lo script ExchUcUtil. ps1 crea uno o più gateway IP di messaggistica unificata.</span><span class="sxs-lookup"><span data-stu-id="fdecd-182">The ExchUcUtil.ps1 script creates one or more UM IP gateways.</span></span> <span data-ttu-id="fdecd-183">È necessario disabilitare le chiamate in uscita in tutti i gateway IP di messaggistica unificata eccetto un gateway creato dallo script.</span><span class="sxs-lookup"><span data-stu-id="fdecd-183">You must disable outgoing calls on all UM IP gateways except one gateway that the script created.</span></span> <span data-ttu-id="fdecd-184">Questo include la disabilitazione delle chiamate in uscita sui gateway IP di messaggistica unificata creati prima dell'esecuzione dello script.</span><span class="sxs-lookup"><span data-stu-id="fdecd-184">This includes disabling outgoing calls on UM IP gateways that were created before you ran the script.</span></span> <span data-ttu-id="fdecd-185">Per disabilitare le chiamate in uscita in un gateway IP di messaggistica unificata, vedere disabilitare le chiamate in uscita nei gateway IP di messaggistica unificata.</span><span class="sxs-lookup"><span data-stu-id="fdecd-185">To disable outgoing calls on a UM IP gateway, see Disable outgoing calls on UM IP gateways.</span></span> 
> [!IMPORTANT]
> <span data-ttu-id="fdecd-186">Per eseguire lo script, è necessario disporre delle autorizzazioni del ruolo di gestione dell'organizzazione di Exchange o di essere membri del gruppo di sicurezza di Exchange Organization Administrators.</span><span class="sxs-lookup"><span data-stu-id="fdecd-186">You must have the permissions of the Exchange Organization Management role or be a member of the Exchange Organization Administrators security group to run the script.</span></span> 

1. <span data-ttu-id="fdecd-187">Aprire Exchange Management Shell.</span><span class="sxs-lookup"><span data-stu-id="fdecd-187">Open the Exchange Management Shell.</span></span>
2. <span data-ttu-id="fdecd-188">Al prompt di C:\Windows\System32 digitare la **lettera \<dell'unità CD>: c:\Programmi\Microsoft\Exchange Server\V15\Scripts>. ExchUcUtil. ps1**e quindi premere INVIO.</span><span class="sxs-lookup"><span data-stu-id="fdecd-188">At the C:\Windows\System32 prompt, type **cd \<drive letter>:\Program Files\Microsoft\Exchange Server\V15\Scripts>.ExchUcUtil.ps1**, and then press Enter.</span></span>

#### <a name="how-do-you-know-this-worked"></a><span data-ttu-id="fdecd-189">Come si fa a sapere che funziona?</span><span class="sxs-lookup"><span data-stu-id="fdecd-189">How do you know this worked?</span></span>

<span data-ttu-id="fdecd-190">Per verificare che lo script ExchUcUtul. ps1 sia stato completato correttamente, eseguire le operazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="fdecd-190">To verify that the ExchUcUtul.ps1 script completed successfully, do the following:</span></span>
- <span data-ttu-id="fdecd-191">Utilizzare il cmdlet Get-UMIPGateway o l'interfaccia di Exchange per visualizzare il nuovo gateway IP di messaggistica unificata o i gateway che sono stati creati.</span><span class="sxs-lookup"><span data-stu-id="fdecd-191">Use the Get-UMIPGateway cmdlet or the EAC to view the new UM IP gateway or gateways that were created.</span></span>
- <span data-ttu-id="fdecd-192">Usare il cmdlet Get-UMHuntGroup o l'interfaccia di Exchange per visualizzare il nuovo gruppo di risposta di messaggistica unificata creato.</span><span class="sxs-lookup"><span data-stu-id="fdecd-192">Use the Get-UMHuntGroup cmdlet or the EAC to view the new UM hunt group or groups that were created.</span></span>

### <a name="configure-certificates-on-the-server-running-exchange-server-unified-messaging"></a><span data-ttu-id="fdecd-193">Configurare i certificati nel server che gestisce la messaggistica unificata di Exchange Server</span><span class="sxs-lookup"><span data-stu-id="fdecd-193">Configure certificates on the server running Exchange Server Unified Messaging</span></span>
 
<span data-ttu-id="fdecd-194">Se è stata distribuita la messaggistica unificata di Exchange, come descritto in pianificazione dell'integrazione della messaggistica unificata di Exchange in Skype for Business Server nella documentazione relativa alla pianificazione e si desidera specificare le caratteristiche di messaggistica unificata di Exchange per gli utenti di VoIP aziendale nella propria organizzazione, è possibile usare le procedure seguenti per configurare il certificato nel server che usa la messaggistica unificata di Exchange.</span><span class="sxs-lookup"><span data-stu-id="fdecd-194">If you have deployed Exchange Unified Messaging (UM), as described in Planning for Exchange Unified Messaging integration in Skype for Business Server in the Planning documentation, and you want to provide Exchange UM features to Enterprise Voice users in your organization, you can use the following procedures to configure the certificate on the server running Exchange UM.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="fdecd-195">Per i certificati interni, sia i server che usano Skype for Business Server che i server che usano Microsoft Exchange devono avere certificati di autorità radice attendibili che sono mutuamente attendibili.</span><span class="sxs-lookup"><span data-stu-id="fdecd-195">For internal certificates, both the servers running Skype for Business Server and the servers running Microsoft Exchange must have trusted root authority certificates that are mutually trusted.</span></span> <span data-ttu-id="fdecd-196">L'autorità di certificazione (CA) può essere uguale o un'autorità di certificazione diversa, purché i server dispongano del certificato radice dell'autorità di certificazione registrato nell'archivio certificati dell'autorità radice attendibile.</span><span class="sxs-lookup"><span data-stu-id="fdecd-196">The certification authority (CA) can either be the same, or a different certification authority, as long as the servers have the certification authority’s root certificate registered in their trusted root authority certificate store.</span></span> 

<span data-ttu-id="fdecd-197">Il server di Exchange deve essere configurato con un certificato server per connettersi a Skype for Business Server:</span><span class="sxs-lookup"><span data-stu-id="fdecd-197">The Exchange Server must be configured with a server certificate in order to connect to Skype for Business Server:</span></span>
1. <span data-ttu-id="fdecd-198">Scaricare il certificato CA per il server Exchange.</span><span class="sxs-lookup"><span data-stu-id="fdecd-198">Download the CA certificate for the Exchange Server.</span></span>
2. <span data-ttu-id="fdecd-199">Installare il certificato CA per il server Exchange.</span><span class="sxs-lookup"><span data-stu-id="fdecd-199">Install the CA certificate for the Exchange Server.</span></span>
3. <span data-ttu-id="fdecd-200">Verificare che la CA si trovi nell'elenco delle autorità di certificazione radice attendibili del server Exchange.</span><span class="sxs-lookup"><span data-stu-id="fdecd-200">Verify that the CA is in the list of trusted root CAs of the Exchange Server.</span></span>
4. <span data-ttu-id="fdecd-201">Creare una richiesta di certificato per il server Exchange e installare il certificato.</span><span class="sxs-lookup"><span data-stu-id="fdecd-201">Create a certificate request for the Exchange Server and install the certificate.</span></span> 
5. <span data-ttu-id="fdecd-202">Assegnare il certificato per il server Exchange.</span><span class="sxs-lookup"><span data-stu-id="fdecd-202">Assign the certificate for the Exchange Server.</span></span>


<span data-ttu-id="fdecd-203">**Per scaricare il certificato CA:**</span><span class="sxs-lookup"><span data-stu-id="fdecd-203">**To download the CA certificate:**</span></span>

1. <span data-ttu-id="fdecd-204">Nel server che esegue la messaggistica unificata di Exchange fare clic sul pulsante **Start**, scegliere **esegui**, digitare **http://\<nome del server della CA emittente>/certsrv**e quindi fare clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="fdecd-204">On the server running Exchange UM, click **Start**, click **Run**, type **http://\<name of your Issuing CA Server>/certsrv**, and then click **OK**.</span></span>
2. <span data-ttu-id="fdecd-205">In selezionare un'attività fare clic su **Scarica un certificato CA, una catena di certificati o un CRL**.</span><span class="sxs-lookup"><span data-stu-id="fdecd-205">Under Select a task, click **Download a CA certificate, certificate chain, or CRL**.</span></span>
3. <span data-ttu-id="fdecd-206">In **scaricare un certificato CA, una catena di certificati o un CRL**selezionare **metodo di codifica per base 64**e quindi fare clic su**Scarica certificato CA**.</span><span class="sxs-lookup"><span data-stu-id="fdecd-206">Under **Download a CA Certificate, Certificate Chain, or CRL**, select **Encoding Method to Base 64**, and then click**Download CA certificate**.</span></span>
   > [!NOTE]
   > <span data-ttu-id="fdecd-207">È anche possibile specificare la codifica DER (Distinguished Encoding Rules) in questo passaggio.</span><span class="sxs-lookup"><span data-stu-id="fdecd-207">You can also specify Distinguished Encoding Rules (DER) encoding at this step.</span></span> <span data-ttu-id="fdecd-208">Se si seleziona la codifica DER, il tipo di file nel passaggio successivo di questa procedura e nel passaggio 10 di **per installare il certificato della CA** è. p7b anziché. cer.</span><span class="sxs-lookup"><span data-stu-id="fdecd-208">If you select DER encoding, the file type in the next step of this procedure and in step 10 of **To Install the CA certificate** is .p7b rather than .cer.</span></span> 
4. <span data-ttu-id="fdecd-209">Nella finestra di dialogo **Download file** fare clic su **Salva**e quindi salvare il file nel disco rigido nel server.</span><span class="sxs-lookup"><span data-stu-id="fdecd-209">In the **File Download** dialog box, click **Save**, and then save the file to the hard disk on the server.</span></span> <span data-ttu-id="fdecd-210">In base alla codifica selezionata nel passaggio precedente, il file includerà un file con estensione cer o. p7b.</span><span class="sxs-lookup"><span data-stu-id="fdecd-210">(The file will have either a .cer or a .p7b file extension, depending on the encoding that you selected in the previous step.)</span></span>

<span data-ttu-id="fdecd-211">**Per installare il certificato CA:**</span><span class="sxs-lookup"><span data-stu-id="fdecd-211">**To install the CA certificate:**</span></span>

1. <span data-ttu-id="fdecd-212">Nel server che esegue la messaggistica unificata di Exchange aprire Microsoft Management Console (MMC) facendo clic sul pulsante **Start**, scegliendo **Esegui**, digitando **MMC** nella casella Apri e quindi facendo clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="fdecd-212">On the server running Exchange UM, open Microsoft Management Console (MMC) by clicking **Start**, clicking **Run**, typing **mmc** in the Open box, and then clicking **OK**.</span></span>
2. <span data-ttu-id="fdecd-213">Nel menu **file** fare clic su **Aggiungi/Rimuovi snap-in**e quindi fare clic su **Aggiungi**.</span><span class="sxs-lookup"><span data-stu-id="fdecd-213">On the **File** menu, click **Add/Remove Snap-in**, and then click **Add**.</span></span>
3. <span data-ttu-id="fdecd-214">Nella casella **Add standalone snap-** in fare clic su **certificati**e quindi fare clic su **Aggiungi**.</span><span class="sxs-lookup"><span data-stu-id="fdecd-214">In the **Add Standalone Snap-ins** box, click **Certificates**, and then click **Add**.</span></span>
4. <span data-ttu-id="fdecd-215">Nella finestra di dialogo di **snap-in certificato** fare clic su **account computer**e quindi su **Avanti**.</span><span class="sxs-lookup"><span data-stu-id="fdecd-215">In the **Certificate snap-in** dialog box, click **Computer account**, and then click **Next**.</span></span>
5. <span data-ttu-id="fdecd-216">Nella finestra di dialogo **Seleziona computer** verificare che la casella di controllo computer **locale: (il computer in cui è in uso questa console)** sia selezionata e quindi fare clic su **fine**.</span><span class="sxs-lookup"><span data-stu-id="fdecd-216">In the **Select Computer** dialog box, verify that the **Local computer: (the computer this console is running on)** check box is selected, and then click **Finish**.</span></span>
6. <span data-ttu-id="fdecd-217">Fare clic su **Chiudi**e quindi su **OK**.</span><span class="sxs-lookup"><span data-stu-id="fdecd-217">Click **Close**, and then click **OK**.</span></span> 
7. <span data-ttu-id="fdecd-218">Nell'albero della console espandere **certificati (computer locale)**, espandere **autorità di certificazione radice attendibili**e quindi fare clic su **certificati**.</span><span class="sxs-lookup"><span data-stu-id="fdecd-218">In the console tree, expand **Certificates (Local Computer)**, expand **Trusted Root Certification Authorities**, and then click **Certificates**.</span></span>
8. <span data-ttu-id="fdecd-219">Fare clic con il pulsante destro del mouse su **certificati**, scegliere **tutte le attività**e fare clic su **Importa**.</span><span class="sxs-lookup"><span data-stu-id="fdecd-219">Right-click **Certificates**, click **All Tasks**, and click **Import**.</span></span>
9. <span data-ttu-id="fdecd-220">Fare clic su **Avanti**.</span><span class="sxs-lookup"><span data-stu-id="fdecd-220">Click **Next**.</span></span> 
10. <span data-ttu-id="fdecd-221">Fare clic su **Sfoglia** per individuare il file e quindi fare clic su **Avanti**.</span><span class="sxs-lookup"><span data-stu-id="fdecd-221">Click **Browse** to locate the file, and then click **Next**.</span></span> <span data-ttu-id="fdecd-222">Il file includerà un'estensione cer o p7b, a seconda della codifica selezionata nel passaggio 3 di **per scaricare il certificato della CA**.</span><span class="sxs-lookup"><span data-stu-id="fdecd-222">(The file will have either a .cer or a .p7b file extension, depending on the encoding that you selected in step 3 of **To download the CA certificate**.</span></span>
11. <span data-ttu-id="fdecd-223">Fare clic su **Inserisci tutti i certificati** nello Store seguente.</span><span class="sxs-lookup"><span data-stu-id="fdecd-223">Click **Place All Certificates** in the following store.</span></span>
12. <span data-ttu-id="fdecd-224">Fare clic su **Sfoglia**e quindi selezionare **autorità di certificazione radice attendibili**.</span><span class="sxs-lookup"><span data-stu-id="fdecd-224">Click **Browse**, and then select **Trusted Root Certification Authorities**.</span></span> 
13. <span data-ttu-id="fdecd-225">Fare clic su **Avanti** per verificare le impostazioni e quindi fare clic su **fine**.</span><span class="sxs-lookup"><span data-stu-id="fdecd-225">Click **Next** to verify the settings, and then click **Finish**.</span></span> 


<span data-ttu-id="fdecd-226">**Per verificare che la CA si trovi nell'elenco delle autorità di certificazione radice attendibili:**</span><span class="sxs-lookup"><span data-stu-id="fdecd-226">**To verify that the CA is in the list of trusted root CAs:**</span></span>

1. <span data-ttu-id="fdecd-227">Nel server che gestisce la messaggistica unificata di Exchange, in MMC Espandi certificati (computer locale), Espandi autorità di certificazione radice attendibili e quindi fai clic su certificati.</span><span class="sxs-lookup"><span data-stu-id="fdecd-227">On the server running Exchange UM, in MMC expand Certificates (Local Computer), expand Trusted Root Certification Authorities, and then click Certificates.</span></span>
2. <span data-ttu-id="fdecd-228">Nel riquadro dei dettagli verificare che la CA sia nell'elenco delle CA attendibili.</span><span class="sxs-lookup"><span data-stu-id="fdecd-228">In the details pane, verify that your CA is on the list of trusted CAs.</span></span>


